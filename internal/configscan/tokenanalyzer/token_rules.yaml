rules:
  - id: risky_destructive_commands
    severity: critical
    meta:
      category: risky_commands
      reason: The tool appears to perform destructive or irreversible operations.
      title: Destructive Command Detected
    strings:
      - name: "$danger_verb"
        type: tokens
        values: ["delete", "remove", "destroy", "drop", "purge", "wipe", "truncate", "erase", "deallocate"]

      - name: "$danger_obj"
        type: tokens
        values: ["file", "files", "directory", "directories", "folder", "folders", "repo", "repos", "branch", "branches", "record", "records", "collection", "collections", "table", "tables", "resource", "resources", "data", "system"]

    condition:
      kind: any_near
      names: ["$danger_verb", "$danger_obj"]
      window: 6

  - id: command_injection
    severity: high
    meta:
      category: command_injection
      reason: Execution of tool/command based on user-controlled or arbitrary input.
    strings:
      - name: "$exec"
        type: tokens
        values: ["execute", "executes", "run", "invoke"]

      - name: "$obj"
        type: tokens
        values: ["tool", "slug", "command", "commands", "script", "code", "function", "functions", "sql", "query", "queries", "statement", "statements"]

    condition:
      kind: any_near
      names: ["$exec", "$obj"]
      window: 8

  - id: insecure_permission_assignment
    severity: high
    meta:
      category: permissions
      reason: Tool modifies permissions/access for users; risk of over-privileged access.
    strings:
      - name: "$verb"
        type: tokens
        values: ["add", "adds", "update", "updates", "modify", "modifies", "set", "grant"]

      - name: "$perm"
        type: tokens
        values: ["permission", "permissions", "access", "privilege", "privileges"]

      - name: "$who"
        type: tokens
        values: ["collaborator", "user", "member", "role"]

    condition:
      kind: any_near
      names: ["$verb", "$perm", "$who"]
      window: 6
  
  - id: content_modification
    severity: medium
    meta:
      category: risky_commands
      reason: Tool modifies content; risk of unintended changes or data loss.
    strings:
      - name: "$verb"
        type: tokens
        values: ["create", "update", "write", "post", "put", "set", "add", "insert", "modify", "edit", "save", "upload", "replace", "rename", "move", "copy", "append", "patch", "grant", "send", "execute", "run", "publish", "deploy", "fork", "merge", "commit", "push", "assign", "approve", "enable", "activate", "configure", "triage", "label", "pin", "star", "clone", "new", "start", "navigate", "fill", "initiate"]

      - name: "$obj"
        type: tokens
        values: ["database", "databases", "table", "tables", "row", "rows", "collection", "collections", "record", "records", "repo", "repos", "branch", "branches", "commit", "commits", "history", "contents", "file", "files", "directory", "directories", "folder", "folders"]

    condition:
      kind: any_near
      names: ["$verb", "$obj"]
      window: 6
  
  - id: unvalidated_user_input
    severity: medium
    meta:
      category: unvalidated_input
      reason: User-provided data is used directly; requires validation/sanitization.
    strings:
      - name: "$user"
        type: tokens
        values: ["user", "client"]

      - name: "$prov"
        type: tokens
        values: ["provided", "supplied", "submitted"]

      - name: "$data"
        type: tokens
        values: ["input", "arguments", "content", "data"]

    condition:
      kind: any_near
      names: ["$user", "$prov", "$data"]
      window: 5

  - id: information_disclosure
    severity: low
    meta:
      category: information_disclosure
      reason: Tool compares commits/repo contents; may expose history or sensitive differences.
    strings:
      - name: "$verb"
        type: tokens
        values: ["get", "list", "read", "fetch", "query", "search", "find", "retrieve", "view", "show", "download", "export", "scan", "watch", "select", "inspect", "monitor", "browse", "analyze", "review", "examine", "understand", "access", "track", "recommend", "suggest", "check", "compare", "verify"]

      - name: "$obj"
        type: tokens
        values: ["database", "databases", "table", "tables", "row", "rows", "collection", "collections", "record", "records", "repo", "repos", "branch", "branches", "commit", "commits", "history", "contents"]

    condition:
      kind: any_near
      names: ["$verb", "$obj"]
      window: 6
